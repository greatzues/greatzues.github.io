<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="zues blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="zues blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="zues blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="zues blog">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?b706031fedc2f13c7dc61b81d4a77d64";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


  <title> zues blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">zues blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            Archiv
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/15/项目感想6/" itemprop="url">
                  项目感想6
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-10-15T11:08:26+08:00" content="2016-10-15">
              2016-10-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/10/15/项目感想6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/10/15/项目感想6/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="使用react-native-picker库"><a href="#使用react-native-picker库" class="headerlink" title="使用react-native-picker库"></a>使用react-native-picker库</h2><p>事先说明，我写这篇博客的时候，其实我使用react-native-picker还没有使用成功，我是为了上传一张我的catch到的error截图，到这个开源的项目里面给项目创始人看一下我的问题出现在哪里而写这篇博客的，当然如果我的难题被解决了，我也会更新这篇博客。</p>
<p><img src="../img/error.JPG" alt="react-native-picker"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/28/项目感想5/" itemprop="url">
                  项目感想5
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-28T15:51:09+08:00" content="2016-09-28">
              2016-09-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/28/项目感想5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/09/28/项目感想5/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="listview上犯了个本不该犯的错误"><a href="#listview上犯了个本不该犯的错误" class="headerlink" title="listview上犯了个本不该犯的错误"></a>listview上犯了个本不该犯的错误</h2><hr>
<p>哎呀！，当时没有写完整，现在重新写发现忘记当时犯了什么错误！</p>
<h2 id="图片的毛玻璃效果"><a href="#图片的毛玻璃效果" class="headerlink" title="图片的毛玻璃效果"></a>图片的毛玻璃效果</h2><hr>
<p>当然在使用这个效果之前，我还尝试过其他例如在listview中使用字母导航的效果，也就是<a href="https://github.com/sunnylqm/react-native-alphabetlistview" target="_blank" rel="external">sunnylqm/react-native-alphabetlistview</a>，当时已经添加依赖之后发现这个效果是静态的，需要自己获取首字母，但是我写的不是国外app，所以还需要将汉字转化为拼音，于是我又找到了这个库<a href="https://github.com/hotoo/pinyin" target="_blank" rel="external">hotoo/pinyin</a>,可惜老天并不眷顾我（其实是我自己能力问题），一致没有install成功，最后只能放弃这个想法了。</p>
<p>还有就是性别和地区选择的滚动选择器，当时我也尝试了，但是还是没有成功实现，我当时使用的是这个库<a href="https://github.com/beefe/react-native-picker" target="_blank" rel="external">beefe/react-native-picker</a>,好尴尬有木有，我没有放弃特效，最后尝试毛玻璃，发誓这次不能轻易放手，坚持fix在install和link之后导致的bug，万万没想到，最后还是fix好了！下面讲一下我的辛苦历程。</p>
<p>一开始的很成功的<code>npm install react-native-blur</code>安装好基础组件，剩下的庞大库就可以通过link来添加远程依赖了，我简单使用npm link或者是rnpm ink都没有效果，最后使用<code>npm link npm install react-native-blur</code>,无形中在cmd里面就输出了成功关联的语句，说明ok了。</p>
<p>接着是看到库的github上原来有分ios和android的不同配置，才发现卧槽，ios配置竟然简单那么多，相比ios几步就配置好，android需要好多步，不过还是被我搞定了，非常兴奋的打开模拟器和cmd，最后又出来下面的错误提示.</p>
<p>也就是link成功之后出现了<code>Error: duplicate files during packaging of APK /home/rafa93br/rn/bountify/android/app/build/outputs/apk/app-debug-unaligned.apk
    Path in archive: lib/x86/libRSSupport.so</code><br>这个答案我在google中找到了github上的一些回答<a href="https://github.com/wasabeef/glide-transformations/issues/24" target="_blank" rel="external">Duplicate files during packaging of APK #24</a>，然后就搞定这个了。其实过程也没有文字说得那么顺利，我还是花了不少时间的。因为在android的文件夹下有两个<code>build.gradle</code>，一个在app同级目录，一个在app子目录里面。</p>
<p>最后就搞定其他的细节bug就成功跑起效果来了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/17/项目感想4/" itemprop="url">
                  项目感想4
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-17T08:53:36+08:00" content="2016-09-17">
              2016-09-17
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/17/项目感想4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/09/17/项目感想4/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="使用listview"><a href="#使用listview" class="headerlink" title="使用listview"></a>使用listview</h2><hr>
<p>在此之前我使用listview只是简单的适配数据到listview上，不过其实看官方文档的话会发现其实关于listview还有很多好处没有注意到，在写这篇博客之前我看过不少关于reactnative的listview文章，不过鉴于我现在的知识暂时还写不上非常优质的分析博文，所以我还是按照我原来的思路写我在项目中要用到的listview的其他属性吧！</p>
<h3 id="ListView-dataSource"><a href="#ListView-dataSource" class="headerlink" title="ListView dataSource"></a>ListView dataSource</h3><hr>
<p>在官方文档里面有专门介绍ListView dataSource的帮助文档，根据翻译很容易理解这是数据源，也就是传入到listview的每一条数据，这里规定传入的数据必须是<strong>数组</strong>,或者是字典里面嵌入数组，上面是字典，我后面会提到。在这里无须像原生那样显式声明section和row的个数，系统会根据传入的数据自动生成section和row，每一个字典的key会被listview标识为一个section，如果没有指定sectionId。那么key就是sectionId。</p>
<p>什么是section（字典）？section，能为每个小节渲染一个粘性的标题，粘性是指当它刚出现时，会处在对应小节的内容的顶部，继续下滑当它到达屏幕顶端的时候，它会停留在屏幕顶端，一直到对应的位置被下一个小节的标题占据为止，效果如下图：<br><img src="http://reactnative.cn/static/docs/0.31/img/components/listview3.png" alt="官网描述section的图片"></p>
<p>但是这里我要提醒一下，这个特效只在ios上才会出现，如果也想在android中实现这个特性，可以参考这篇博文：<a href="http://lyan.me/2016/07/07/react-native%E4%BD%BF%E7%94%A8/" target="_blank" rel="external">react-native使用</a>.</p>
<p>使用dataSource的步骤一般情况下时这样的：<code>var ds = new ListView.DataSource();</code>，其中DataSource中的参数可以是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by zues on 2016/8/26.</span><br><span class="line"> */</span><br><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; View, Text, StyleSheet, Image, Navigator &#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">export default class BottomTap extends Component &#123;</span><br><span class="line">    constructor(props)&#123;</span><br><span class="line">        super(props);</span><br><span class="line">		const ds = new ListView.DataSource(&#123;</span><br><span class="line">            rowHasChanged: (r1, r2) =&gt; r1 !== r2,</span><br><span class="line">            sectionHeaderHasChanged: (s1, s2) =&gt; s1 !== s2</span><br><span class="line">        &#125;);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            dataSource: ds.cloneWithRowsAndSections(&#123;</span><br><span class="line">				&apos;section1&apos;:[&apos;test1&apos;,&apos;test2&apos;,&apos;test3&apos;,&apos;test4&apos;,&apos;test5&apos;,&apos;test6&apos;,&apos;test7&apos;]</span><br><span class="line">				&apos;section2&apos;:[&apos;test8&apos;,&apos;test9&apos;,&apos;test10&apos;,&apos;test11&apos;,&apos;test12&apos;,&apos;test13&apos;,&apos;test14&apos;]</span><br><span class="line">			&#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    render()&#123;</span><br><span class="line">        return(</span><br><span class="line">            &lt;ListView</span><br><span class="line">                    renderSectionHeader = &#123;this.sectionHeader&#125;</span><br><span class="line">                    dataSource=&#123;this.state.dataSource&#125;</span><br><span class="line">                    renderRow=&#123;this.myRenderRow&#125;</span><br><span class="line">                    /&gt;</span><br><span class="line">		)</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	myRenderRow(rowData,sectionID,rowID,highlightRow)&#123;</span><br><span class="line">        return(</span><br><span class="line">            &lt;View style = &#123;styles.input&#125;&gt;</span><br><span class="line">                &lt;Text style=&#123;&#123;marginLeft:10&#125;&#125;&gt;&#123;rowData&#125;&lt;/Text&gt;</span><br><span class="line">                &lt;TextInput style=&#123;&#123;flex:1&#125;&#125;</span><br><span class="line">                           value=&#123;this.state.postData.key[rowID]&#125;</span><br><span class="line">                           onChangeText=&#123;this.myOnChangeText&#125;</span><br><span class="line">                &gt;&#123;&apos;请输入&apos;+rowData&#125;&lt;/TextInput&gt;</span><br><span class="line">            &lt;/View&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	//分隔线，我觉得不加进去会更好看一点 使用方法：renderSeparator=&#123;this.renderSeparator&#125;</span><br><span class="line">    renderSeparator(sectionID, rowID, highlightRow)&#123;</span><br><span class="line">        return(</span><br><span class="line">            &lt;View style=&#123;&#123;height:2,width:deviceWidth,backgroundColor:&apos;skyblue&apos;&#125;&#125;&gt;&lt;/View&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">	sectionHeader(sectionData, sectionID)&#123;</span><br><span class="line">            return(</span><br><span class="line">                &lt;View style=&#123;styles.rowTitle&#125;&gt;</span><br><span class="line">                    &lt;Text&gt;&#123;sectionID&#125;&lt;/Text&gt;</span><br><span class="line">                &lt;/View&gt;</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const styles = StyleSheet.create(&#123;</span><br><span class="line">    input:&#123;</span><br><span class="line">        flexDirection: &apos;row&apos;,</span><br><span class="line">        width:deviceWidth,</span><br><span class="line">        alignItems:&apos;center&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    rowTitle:&#123;</span><br><span class="line">        height:30,</span><br><span class="line">        alignItems:&apos;center&apos;,</span><br><span class="line">        justifyContent:&apos;center&apos;,</span><br><span class="line">        backgroundColor:&apos;#ccc&apos;,</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<h2 id="自动登录"><a href="#自动登录" class="headerlink" title="自动登录"></a>自动登录</h2><hr>
<p>趁着刚刚写完这个功能我要说一下我学的新东西，首先我在用户第一次登录的时候保存用户的账号和密码，然后在全局里面通过账号和密码判断是否是第一次登录，为了实现登录,我使用了react native自带的储存AsyncStorage，在一开始实现取出username和password之前遇到不少坑，例如单纯的取一个会有异步而失败，为了防止这个情况发生，我要保证一次性取出两个值，然后将这个两个值传入到登录方法里面。</p>
<p>然后按照自己脑补的做法一直没有成功，最后看了官方文档，发现使用multiGet方法取出的键值是保存在一个二维数组，然后就出现了下面的代码。我也在代码里面注释过了，就这样简单实现了取两个保存值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">autoLogin()&#123;</span><br><span class="line">        var URL = &apos;/student/login&apos;;</span><br><span class="line">        var username = &apos;&apos;;</span><br><span class="line">        var password = &apos;&apos;;</span><br><span class="line">        //分别拿到在AsyncStorage中储存的username和password，这里取的方式比较特别，是在数组里面取。</span><br><span class="line">        AsyncStorage.multiGet([&apos;username&apos;,&apos;password&apos;],(error, result) =&gt; &#123;</span><br><span class="line">            username=result[0][1];</span><br><span class="line">            password =result[1][1];</span><br><span class="line">            new Net().postLoginMethod(URL,username,password).then((responseData) =&gt; &#123;</span><br><span class="line">                console.log(responseData.status);</span><br><span class="line">            &#125;).catch(error =&gt; &#123;</span><br><span class="line">                alert(&quot;网络出现错误&quot;);</span><br><span class="line">                console.error(error);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="页面值通信实现pop之后重渲染"><a href="#页面值通信实现pop之后重渲染" class="headerlink" title="页面值通信实现pop之后重渲染"></a>页面值通信实现pop之后重渲染</h2><hr>
<p>在A页面中的push里面声明一个参数，在参数里面将A的回调函数传递过去，然后在B页面修改数据之后通过<code>this.props.callback();</code>，也就是在pop之前调用刚刚A传递过来的组件，这条语句要在pop之前使用，因为这样才会在跳转之前通过通信告诉A页面要执行多一次刚刚的回调方法嘛！下面开始贴代码：</p>
<h3 id="A页面"><a href="#A页面" class="headerlink" title="A页面"></a>A页面</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">const &#123; navigator &#125; = this.props;</span><br><span class="line">if( navigator ) &#123;</span><br><span class="line">    navigator.push(&#123;</span><br><span class="line">        name: &apos;Login&apos;,</span><br><span class="line">        component: Login,</span><br><span class="line">        params:&#123;</span><br><span class="line">            callback:() =&gt; this.reRenderData(),</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">				</span><br><span class="line">	reRenderData()&#123;</span><br><span class="line">        this.setState(&#123;selectTab:&apos;home&apos;&#125;);</span><br><span class="line">        this.refs.user.componentDidMount();</span><br><span class="line">        this.refs.drawerView.componentDidMount();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="B页面"><a href="#B页面" class="headerlink" title="B页面"></a>B页面</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">const &#123; navigator &#125; = this.props;</span><br><span class="line">    if (navigator)&#123;</span><br><span class="line">        this.props.callback();</span><br><span class="line">         navigator.pop();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>注意：A和B页面的callback要名字对应，也就是key要对应才能正确通信。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/06/项目感想2/" itemprop="url">
                  项目感想2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-09-06T14:05:57+08:00" content="2016-09-06">
              2016-09-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/06/项目感想2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/09/06/项目感想2/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>只是单纯的记录一下我的坑，我是为了获取登录的cookie才记下的这博客，我也不是弄了很久，也就两天而已，两天啊！</p>
<p>我以为只是简单的像拿数组那样取数组里面的数组那样来拿，所以直接用response[3],因为我在遍历response.headers之后返回的object中cookie是第四个，所以我计划用这个拿，但是取不到cookie。我直接用response.headers.cookie，这个也拿不到，很桑心啊！因为在变量打印出来的object中cookie是用set-cookie打印出来的，所以我又用response.headers.setCookie来取，反正就是试过很多，最后看我的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">postLoginMethod(url,myUsername,myPassword) &#123;</span><br><span class="line">        var myHeaders = [];</span><br><span class="line">        var first = [];</span><br><span class="line">        return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">            fetch(BASEURL+url, &#123;</span><br><span class="line">                method: &apos;post&apos;,</span><br><span class="line">                headers: &#123;</span><br><span class="line">                    &apos;Accept&apos;: &apos;application/json&apos;,</span><br><span class="line">                    &apos;Content-Type&apos;: &apos;application/json&apos;,</span><br><span class="line">                &#125;,</span><br><span class="line">                body:JSON.stringify(&#123;</span><br><span class="line">                    username: myUsername,</span><br><span class="line">                    password: myPassword,</span><br><span class="line">                &#125;),</span><br><span class="line">            &#125;)</span><br><span class="line">                .then((response) =&gt; &#123;</span><br><span class="line">                    myHeaders = response.headers;</span><br><span class="line">                    console.log(...myHeaders); //遍历headers拿到数组对象</span><br><span class="line">                    console.log(&apos;Content-Type:&apos;+ response.headers.get(&apos;Content-Type&apos;)); </span><br><span class="line">                    console.log(&apos;cookie是:&apos;+response.headers.get(&apos;set-cookie&apos;)); //第一次登陆可以拿到cookie</span><br><span class="line">                    console.log(&apos;server:&apos;+response.headers.get(&apos;server&apos;));</span><br><span class="line">                    resolve(response.json());</span><br><span class="line">                &#125;)</span><br><span class="line">                .catch(error =&gt; &#123;</span><br><span class="line">                    alert(&quot;网络出现异常&quot;);</span><br><span class="line">                    reject(error);</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>所以看到上面的代码就应该知道了，其实只需要用<code>response.headers.get(&#39;set-cookie&#39;)</code>，这个安卓里面几乎是一模一样的，我咋就没想到呢！</p>
<p>然后也看到我的代码旁边的注释，不知道为什么在reactnative中是自动在第一次登陆之后就可以携带cookie去访问其他uri了，但是我还是先保存cookies，以防万一。因为在我第二次用同样的账号密码登录的时候就没返回cookie对象，取而代之的只是server信息，说明已经被标记为已登录状态了。</p>
<h2 id="图片上传"><a href="#图片上传" class="headerlink" title="图片上传"></a>图片上传</h2><hr>
<p>我参照<a href="http://blog.qiniu.com/archives/5806" target="_blank" rel="external">用纯JAVASCRIPT实现REACT NATIVE的文件上传</a>，顺便修改一些代码然后就完成了reactnative的头像上传功能，呃，其实里面有一些bug，还好我和后台的小伙伴互相商量解决了一点，但是还是出现返回的状态码不正常的情况，如果有完美上传头像的办法，记得要告诉我啊！<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">postFile(url, imgUri,filename)&#123;</span><br><span class="line">        //用来包装响应头的数组</span><br><span class="line">        //构造request的body里面的东西</span><br><span class="line">        let formData = new FormData();</span><br><span class="line">        formData.append(&apos;avatar&apos;, &#123;uri: imgUri, type: &apos;image/jpeg&apos;, name:filename&#125;);</span><br><span class="line"></span><br><span class="line">        let options = &#123;&#125;;</span><br><span class="line">        options.body = formData;</span><br><span class="line">        options.method = &apos;post&apos;;</span><br><span class="line">        return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">            fetch(BASEURL+ url, options).then((response) =&gt; &#123;</span><br><span class="line">                resolve(response)</span><br><span class="line">            &#125;)</span><br><span class="line">                .catch(error =&gt; &#123;</span><br><span class="line">                    alert(&quot;上传失败&quot;);</span><br><span class="line">                    reject(error);</span><br><span class="line">                &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>这个封装的函数返回一个promise对象，可以在调用的时候使用返回的response作为回调参数。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/28/项目感想/" itemprop="url">
                  项目感想
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-08-28T08:44:51+08:00" content="2016-08-28">
              2016-08-28
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/28/项目感想/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/28/项目感想/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="代码块"><a href="#代码块" class="headerlink" title="代码块"></a>代码块</h2><hr>
<p>不是我吹牛啊，刚刚把想了一晚的组件通信那部分写好了，现在有一点经验分享给自己，首先贴上部分代码：</p>
<h3 id="index-android-js"><a href="#index-android-js" class="headerlink" title="index.android.js"></a>index.android.js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">      let defaultName = &apos;BottomTap&apos;;</span><br><span class="line">      let defaultComponent = BottomTap;</span><br><span class="line">      if(this.state.toStartPage)&#123;</span><br><span class="line">          return(</span><br><span class="line">              &lt;StartPage /&gt;</span><br><span class="line">          );</span><br><span class="line">      &#125;else &#123;</span><br><span class="line">          var initialRoute = &#123;name: defaultName, component: defaultComponent&#125;;</span><br><span class="line">          return(</span><br><span class="line">              &lt;Navigator</span><br><span class="line">                  sceneStyle=&#123;styles.container&#125;</span><br><span class="line">                  initialRoute=&#123;initialRoute&#125;</span><br><span class="line">                  configureScene=&#123;(route) =&gt; Navigator.SceneConfigs.FadeAndroid&#125;</span><br><span class="line">                  renderScene=&#123;(route, navigator) =&gt; &#123;</span><br><span class="line">                      let Component  = route.component;</span><br><span class="line">                      return &lt;Component &#123;...route.params&#125; navigator=&#123;navigator&#125;/&gt;</span><br><span class="line">                  &#125;&#125;/&gt;</span><br><span class="line">          );</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h3 id="BottomTap-js"><a href="#BottomTap-js" class="headerlink" title="BottomTap.js"></a>BottomTap.js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;TabNavigator.Item</span><br><span class="line">                title = &quot;主页&quot;</span><br><span class="line">                selected = &#123;this.state.selectTab === &apos;home&apos;&#125;</span><br><span class="line">                selectedTitleStyle = &#123;styles.seletedTextStyle&#125;</span><br><span class="line">                titleStyle =&#123;styles.textStyle&#125;</span><br><span class="line">                renderIcon = &#123;() =&gt; &lt;Image source=&#123;require(&apos;./img/home.png&apos;)&#125; style=&#123;styles.iconStyle&#125;/&gt; &#125;</span><br><span class="line">                renderSelectedIcon =&#123;() =&gt; &lt;Image source=&#123;require(&apos;./img/home_selected.png&apos;)&#125; style=&#123;styles.iconStyle&#125;/&gt; &#125;</span><br><span class="line">                onPress=&#123;() =&gt; this.setState(&#123;selectTab:&apos;home&apos;&#125;)&#125;&gt;</span><br><span class="line">	</span><br><span class="line">		&lt;Home homeClick=&#123;this.click.bind(this)&#125;/&gt;</span><br><span class="line">		</span><br><span class="line">            &lt;/TabNavigator.Item&gt;	</span><br><span class="line">//...此处省略了很多代码</span><br><span class="line">click()&#123;</span><br><span class="line">	const &#123; navigator &#125; = this.props;</span><br><span class="line">	if( navigator ) &#123;</span><br><span class="line">		navigator.push(&#123;</span><br><span class="line">			name: &apos;Login&apos;,</span><br><span class="line">			component: Login,</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Home-js"><a href="#Home-js" class="headerlink" title="Home.js"></a>Home.js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">       var navigationView = (</span><br><span class="line">           &lt;View &gt;</span><br><span class="line">               &lt;Text style=&#123;[styles.text,&#123;marginTop: 20&#125;]&#125; onPress=&#123;() =&gt;this.setState(&#123;absence : &apos;已签到&apos;&#125;) &#125;&gt;&#123;this.state.absence&#125;&lt;/Text&gt;</span><br><span class="line">           &lt;/View&gt;</span><br><span class="line">       );</span><br><span class="line"></span><br><span class="line">       return (</span><br><span class="line">           &lt;View&gt;</span><br><span class="line">               &lt;Toolbar ref = &quot;toolbar&quot; click = &#123;this.props.homeClick&#125; /&gt;</span><br><span class="line">               &lt;View&gt;&lt;PicBanner/&gt;&lt;/View&gt;</span><br><span class="line">               &lt;TouchableOpacity&gt;</span><br><span class="line">                   &lt;View style = &#123;styles.textStyle&#125; onPress=&#123;() =&gt; this.setState&#125;&gt;</span><br><span class="line">                       &lt;Text style=&#123;styles.text&#125;&gt;机电小广场&lt;/Text&gt;</span><br><span class="line">                   &lt;/View&gt;</span><br><span class="line">               &lt;/TouchableOpacity&gt;</span><br><span class="line">               &lt;View style=&#123;&#123;height: 65&#125;&#125;&gt;</span><br><span class="line">                   &lt;DrawerLayoutAndroid</span><br><span class="line">                       drawerWidth=&#123;100&#125;</span><br><span class="line">                       drawerPosition=&#123;DrawerLayoutAndroid.positions.Right&#125;</span><br><span class="line">                       renderNavigationView=&#123;() =&gt;navigationView&#125;&gt;</span><br><span class="line"></span><br><span class="line">                           &lt;TouchableOpacity style=&#123;styles.drawerLayoutAndroidView&#125; &gt;</span><br><span class="line">                               &lt;View &gt;&lt;Text style=&#123;styles.drawerLayoutAndroidText&#125;&gt;我的班级我的家&lt;/Text&gt;&lt;/View&gt;</span><br><span class="line">                               &lt;View style=&#123;&#123;flexDirection: &apos;row&apos;,alignItems: &apos;center&apos;,marginLeft:5,marginRight:20&#125;&#125;&gt;</span><br><span class="line">                                   &lt;Text&gt;左划签到&lt;/Text&gt;</span><br><span class="line">                                   &lt;Image source=&#123;require(&apos;./img/arrow_left.png&apos;)&#125; style=&#123;&#123;height: 12&#125;&#125;&gt;&lt;/Image&gt;</span><br><span class="line">                               &lt;/View&gt;</span><br><span class="line">                           &lt;/TouchableOpacity&gt;</span><br><span class="line"></span><br><span class="line">                   &lt;/DrawerLayoutAndroid&gt;</span><br><span class="line">               &lt;/View&gt;</span><br><span class="line"></span><br><span class="line">               &lt;TouchableOpacity&gt;</span><br><span class="line">                   &lt;View style = &#123;styles.textStyle&#125;&gt;&lt;Text style=&#123;styles.text&#125;&gt;机电简讯&lt;/Text&gt;&lt;/View&gt;</span><br><span class="line">               &lt;/TouchableOpacity&gt;</span><br><span class="line"></span><br><span class="line">                &lt;TouchableOpacity&gt;</span><br><span class="line">                   &lt;View style = &#123;styles.textStyle&#125;&gt;&lt;Text style=&#123;styles.text&#125;&gt;校友风采&lt;/Text&gt;&lt;/View&gt;</span><br><span class="line">               &lt;/TouchableOpacity&gt;</span><br><span class="line">           &lt;/View&gt;</span><br><span class="line">       );</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="Toolbar-js"><a href="#Toolbar-js" class="headerlink" title="Toolbar.js"></a>Toolbar.js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">render()&#123;</span><br><span class="line">       return(</span><br><span class="line">           &lt;ToolbarAndroid</span><br><span class="line">               actions=&#123;toolbarActions&#125;</span><br><span class="line">               style=&#123;styles.toolbar&#125;</span><br><span class="line">               title= &quot;机电E家人&quot;</span><br><span class="line">               navIcon = &#123;require(&apos;./img/pic.png&apos;)&#125;</span><br><span class="line">               onIconClicked=&#123;this.props.click&#125;</span><br><span class="line">               onActionSelected=&#123;this.onActionSelected&#125;&gt;</span><br><span class="line"></span><br><span class="line">           &lt;/ToolbarAndroid&gt;</span><br><span class="line">       );</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h2 id="安卓手机物理键BackAndroid的使用"><a href="#安卓手机物理键BackAndroid的使用" class="headerlink" title="安卓手机物理键BackAndroid的使用"></a>安卓手机物理键BackAndroid的使用</h2><hr>
<p>首先我要埋怨一下我做这个整个用了一天，仅仅是一个小功能而已。贴上代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Sample React Native App</span><br><span class="line"> * https://github.com/facebook/react-native</span><br><span class="line"> * @flow</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123;AppRegistry,StyleSheet,Text,View,Navigator,BackAndroid,ToastAndroid&#125; from &apos;react-native&apos;;</span><br><span class="line">import StartPage from &apos;./StartPage&apos;;</span><br><span class="line">import BottomTap from &apos;./BottomTap&apos;;</span><br><span class="line"></span><br><span class="line">class ElectromechanicalFamily extends Component &#123;</span><br><span class="line">  constructor(props) &#123;</span><br><span class="line">    super(props);</span><br><span class="line">      var Nav;</span><br><span class="line">    this.state = &#123;</span><br><span class="line">      toStartPage : true,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">    onBackAndroid = () =&gt; &#123;</span><br><span class="line">        if(Nav.getCurrentRoutes().length &gt; 1)&#123;</span><br><span class="line">            Nav.pop();</span><br><span class="line">            return true;</span><br><span class="line">        &#125;else &#123;if (this.lastBackPressed &amp;&amp; this.lastBackPressed + 2000 &gt;= Date.now()) &#123;</span><br><span class="line">            //最近2秒内按过back键，可以退出应用。</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">            this.lastBackPressed = Date.now();</span><br><span class="line">            ToastAndroid.show(&apos;再按一次退出应用&apos;,ToastAndroid.SHORT);</span><br><span class="line">            return true;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">  componentDidMount() &#123;</span><br><span class="line">    this.timer = setTimeout(() =&gt; &#123;</span><br><span class="line">        this.setState(&#123;</span><br><span class="line">            toStartPage: false,</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;,3000);</span><br><span class="line"></span><br><span class="line">    BackAndroid.addEventListener(&apos;hardwareBackPress&apos;, this.onBackAndroid);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">    //解除定时器</span><br><span class="line">    componentWillUnMount() &#123;</span><br><span class="line">        this.timer &amp;&amp; clearTimeout(this.timer);</span><br><span class="line"></span><br><span class="line">        BackAndroid.removeEventListener(&apos;hardwareBackPress&apos;, this.onBackAndroid);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">  render() &#123;</span><br><span class="line">      let defaultName = &apos;BottomTap&apos;;</span><br><span class="line">      let defaultComponent = BottomTap;</span><br><span class="line">      if(this.state.toStartPage)&#123;</span><br><span class="line">          return(</span><br><span class="line">              &lt;StartPage /&gt;</span><br><span class="line">          );</span><br><span class="line">      &#125;else &#123;</span><br><span class="line">          var initialRoute = &#123;name: defaultName, component: defaultComponent&#125;;</span><br><span class="line"></span><br><span class="line">          return(</span><br><span class="line">              &lt;Navigator</span><br><span class="line">                  sceneStyle=&#123;styles.container&#125;</span><br><span class="line">                  initialRoute=&#123;initialRoute&#125;</span><br><span class="line">                  configureScene=&#123;(route) =&gt; Navigator.SceneConfigs.FadeAndroid&#125;</span><br><span class="line">                  renderScene=&#123;(route, navigator) =&gt; &#123;</span><br><span class="line">                      Nav = navigator;</span><br><span class="line">                      let Component  = route.component;</span><br><span class="line">                      return &lt;Component &#123;...route.params&#125; navigator=&#123;navigator&#125;/&gt;</span><br><span class="line">                  &#125;&#125;/&gt;</span><br><span class="line">          );</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>在构造函数中创建一个全局的变量<code>Nav</code>，用来在renderScene中保持<code>navigator</code>对象。然后就可以使用<code>getCurrentRoutes()</code>来获得当前的route了，route其实就是记录路径的一个数组（呃，应该是数组，纯属自己理解如有不对的地方还请指出）。</p>
<p>判断假如当前路径不是initialRoute的话就正常<code>pop()</code>返回,如果是首页的话就提示是否要退出应用。<code>BackAndroid</code>的addEventListener中第二个参数是一个handle方法，这个方法返回true表示默认按下物理back键正常退出，而返回true表示要do something而不执行物理键的直接退出操作。</p>
<p>一开始的时候看了很多博客和demo，但是reactnative更新实在是太快，很多以前ES5写的都已经过时了，而且自己对于navigator的基础又不太牢固，所以一直都是写错了，特别是<code>Nav = navigator;</code>这一句代码，最令我头疼，因为很多博客的做法都是直接在方法体里面执行下面的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">onBackAndroid = () =&gt; &#123;</span><br><span class="line">    const nav = this.navigator;</span><br><span class="line">    const routers = nav.getCurrentRoutes();</span><br><span class="line">    if (routers.length &gt; 1) &#123;</span><br><span class="line">      nav.pop();</span><br><span class="line">      return true;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure></p>
<p>上面的代码是参考中文网的<a href="http://reactnative.cn/post/480" target="_blank" rel="external">安卓Back键的处理·基本+高级篇</a>我不知道是否我写错什么地方了，但是就是用上面的代码会报<code>undefined is not object</code>错，意思是navigator未定义不是一个object，这就让我郁闷了很久了。</p>
<p>不过这仅仅是我个人的情况，或许真的是我写错了，最后我采用在renderScene里面获取navigator的时候成功取到navigator对象。</p>
<hr>
<p>根据我自己的逻辑一步一步下来，给未来的自己看当时的自己：</p>
<blockquote>
<p>首先是<code>index.android.js</code>,可以看到导航器这里的initialRoute初始化界面是<code>BottomTap.js</code>，于是我们开始看第二段代码<code>BottomTap.js</code>,这里的功能是仿微信的底部导航条，其中主页显示的组件是<code>Home.js</code>.<br>再看到<code>Home.js</code>中使用了<code>Toolbar</code>组件，好了，事情的源头就是从这里开始，我想给<code>Toolbar</code>的onIconClicked创建页面跳转到登录页面，这时候我使用的是props在组件间通信，于是可以看到<code>onIconClicked={this.props.click}</code>。<br>见到props，理所当然就是回去看调用<code>Toolbar</code>的父组件<code>Home.js</code>，这里可以看到代码<code>&lt;Toolbar ref = &quot;toolbar&quot; click = {this.props.homeClick} /&gt;</code>,又传递了props，怎么那么麻烦？别方啊！着急吃不了热豆腐，继续看下一个调用的组件<br>这时候就来到<code>BootomTap.js</code>,可以看到<code>&lt;Home homeClick={this.click.bind(this)}/&gt;</code>,已经很明显了，homeClick属性调用的方法就是click方法，熟悉导航器navigator的使用之后就很熟悉click方法体里面的逻辑了</p>
</blockquote>
<p>补充一下：click方法体里面，因为index.android.js哪里的<code>return &lt;Component {...route.params} navigator={navigator}/&gt;</code>返回了含有navigator的属性的组件，所以这里的<code>BottomTap</code>必须要有navigator属性，传递的是Navigator导航的方法,这里的属性是可以<code>navigator={navigator}</code>传递的参数里面的navigator是可以使用pop，push等一系列方法的。</p>
<h2 id="纠错"><a href="#纠错" class="headerlink" title="纠错"></a>纠错</h2><hr>
<p>在这个成功页面跳转之前，我试过一系列的方法，index.android.js里面的代码不变，但是我却是将属性只传到<code>Home.js</code>就结束了，一开始其实我只是在<code>Toolbar.js</code>里面使用navigator跳转，很明显是不可以的，在<code>Home.js</code>里面也尝试过页面跳转，也是不行。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><hr>
<blockquote>
<p>当需要在多层调用的组件，也就是Dom结构分支很多的情况下进行页面跳转跳转的话，例如dom结构此时是这样的<code>parent&lt;=child&lt;=child&#39;s child&lt;= (child&#39;s child)&#39;s child</code>,箭头表示调用，一定要在“按钮/点击”所调用的方法里将方法传递到之间渲染给用户看到的最高父组件里面执行，不然将无法跳转。</p>
</blockquote>
<p>呃，如果没看懂，建议多看几遍上面的解释。</p>
<blockquote>
<p>另外通过ref也可以传递子组件里面的方法，关于ref，使用时直接在组件里面添加<code>&lt;childComponent ref = &quot;refName&quot; /&gt;</code>,假如childComponent里面有一个sayHello的方法，那么在父组件里面调用的时候就可以使用<code>this.refs.refName.sayHello()</code>,refName可以自己定义。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/22/深度解析rn知乎日报/" itemprop="url">
                  深度解析rn知乎日报
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-08-22T08:25:55+08:00" content="2016-08-22">
              2016-08-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/22/深度解析rn知乎日报/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/22/深度解析rn知乎日报/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="推荐："><a href="#推荐：" class="headerlink" title="推荐："></a>推荐：</h2><hr>
<p>文章的开始之前我要先推荐一篇博客，写得非常清晰，笔者看完瞬间觉得逻辑清晰了很多，献上地址：<a href="http://codecloud.net/11084.html" target="_blank" rel="external">React 组件构造方法: ES5 (createClass) 还是 ES6 (class)？ | 程序员的资料库</a>。</p>
<h2 id="正文：index-android-js"><a href="#正文：index-android-js" class="headerlink" title="正文：index.android.js"></a>正文：index.android.js</h2><hr>
<p>首先看到入口<code>index.android.js</code>,这里是用ES5写的代码，在ES6中默认是使用严格方式，因此这里的ues strict在ES6中就可以省略了。然后是ES5以前导入其他函数的语法，ES6就使用import关键字来做同样的事情了。好了，后面肯定还有很多ES5的语法，但是暂时不用理了，因为这对于代码阅读没有多大的影响。</p>
<p>接着是声明一个<code>_navigator</code>变量，编写安卓手机物理返回键的事件监听，判断是否在此页面之前还有导航页，如果存在的话就使用<code>pop()</code>方法返回，返回true表示执行这个物理键操作。</p>
<p>然后是入口类<code>RCTZhiHuDaily</code>,一开始看到的是mixins,这个暂时不知道是什么，先不管后面用到的时候再回头说。那现在就开始接触组件的生命周期了：</p>
<blockquote>
<ul>
<li>getInitialState: 获得初始化组件状态，只调用一次，在ES6中被构造函数取代。</li>
<li>componentWillMount：组件将要加载，只调用一次</li>
<li>componentDidMount：组件加载完成并显示出来了，也就是完成了一次绘制，只调用一次</li>
<li>render：绘制组件，可能调用多次</li>
</ul>
</blockquote>
<p>可以看到在<code>componentDidMount</code>方法中设置了一个定时器，里面有一个开关，应该是启动页轮播图的开关，不过经过我翻译这个单词（译为“溅”）之后就不这么想了，肯定不是轮播图的，因为这个单词有个组合splash screen，译为启动页面.</p>
<p><code>RouteMapper</code>函数：相当于路由的函数，接收route，navigationOperations，onComponentRef三个参数，将传进去的onComponentRef赋值给_navigator,判断传进去的页面name，假如是home，就返回MainScreen组件，假如是story，就返回详情页StoryScreen，并且通过组件通信传递文章详情，两个返回的组件都有一个同样的属性那就是navigator，毋庸置疑，那肯定就是在路由中传递的组件Component了。</p>
<p>getInitialState函数：在组件初始化的时候将状态的成员splashed开关设为false</p>
<p>onActionSelected函数：没有处理方法</p>
<p>render函数：判断假如splash为true的时候返回启动页面initialRoute的name为home，结合上面的RouteMapper函数，可以知道此时会返回一个MainScreen组件，并且在render属性也明确了路由函数是<code>this.RouteMapper</code>。</p>
<p>最后是样式，flexDirections为column表示排列为竖直，如果是row则是水平。</p>
<p>分析到这里的时候开始有点糊涂了，为什么要一开始getInitialState要将splashed设为false，然后又在componentDidMount放一个定时器将splashed改为true,直接将其设为true不就好了吗。先去看看SplashScreen和MainScreen，回头再来补充。<br>》————–<strong><em>我是补充</em></strong>——————-》</p>
<blockquote>
<p>果然和我想的一样，首先是在渲染的时候进入一个动画的启动导航页，页面只有一幅图片，并且通过动画缩小的特效来做的引导页，然后在渲染完成之后通知<code>componentDidMount</code>函数，在<code>componentDidMount</code>函数里面设置定时时间，之后执行<code>setState</code>方法跳转到首页，哈哈，特效挺漂亮的。</p>
</blockquote>
<p>另外这里还有一个疑问就是setTimeout和setInterval的区别，setTimeout是在指定延迟时间去执行一次表达式，仅执行一次，而setInterval则是每隔指定的时间就执行一次表达式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Sample React Native App</span><br><span class="line"> * https://github.com/facebook/react-native</span><br><span class="line"> */</span><br><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">var React = require(&apos;react-native&apos;);</span><br><span class="line">//import React from &apos;react-native&apos;;</span><br><span class="line">var &#123;</span><br><span class="line">  AppRegistry,</span><br><span class="line">  BackAndroid,</span><br><span class="line">  Text,</span><br><span class="line">  View,</span><br><span class="line">  Navigator,</span><br><span class="line">  StyleSheet,</span><br><span class="line">  ToolbarAndroid,</span><br><span class="line">  ToastAndroid,</span><br><span class="line">&#125; = React;</span><br><span class="line">var SplashScreen = require(&apos;./SplashScreen&apos;);</span><br><span class="line">var MainScreen = require(&apos;./MainScreen&apos;);</span><br><span class="line">var StoryScreen = require(&apos;./StoryScreen&apos;);</span><br><span class="line">var ToolbarAndroid = require(&apos;ToolbarAndroid&apos;);</span><br><span class="line">var TimerMixin = require(&apos;react-timer-mixin&apos;);</span><br><span class="line"></span><br><span class="line">var _navigator;</span><br><span class="line">BackAndroid.addEventListener(&apos;hardwareBackPress&apos;, () =&gt; &#123;</span><br><span class="line">  if (_navigator &amp;&amp; _navigator.getCurrentRoutes().length &gt; 1) &#123;</span><br><span class="line">    _navigator.pop();</span><br><span class="line">    return true;</span><br><span class="line">  &#125;</span><br><span class="line">  return false;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var RCTZhiHuDaily = React.createClass(&#123;</span><br><span class="line">  mixins: [TimerMixin],</span><br><span class="line">  componentDidMount: function() &#123;</span><br><span class="line">    this.setTimeout(</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        this.setState(&#123;splashed: true&#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      2000,</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">  RouteMapper: function(route, navigationOperations, onComponentRef) &#123;</span><br><span class="line">    _navigator = navigationOperations;</span><br><span class="line">    if (route.name === &apos;home&apos;) &#123;</span><br><span class="line">      return (</span><br><span class="line">        &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">          &lt;MainScreen navigator=&#123;navigationOperations&#125;/&gt;</span><br><span class="line">        &lt;/View&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125; else if (route.name === &apos;story&apos;) &#123;</span><br><span class="line">      return (</span><br><span class="line">        &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">          &lt;StoryScreen</span><br><span class="line">            style=&#123;&#123;flex: 1&#125;&#125;</span><br><span class="line">            navigator=&#123;navigationOperations&#125;</span><br><span class="line">            story=&#123;route.story&#125; /&gt;</span><br><span class="line">        &lt;/View&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getInitialState: function() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      splashed: false,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  onActionSelected: function(position) &#123;</span><br><span class="line">  &#125;,</span><br><span class="line">  render: function() &#123;</span><br><span class="line">    if (this.state.splashed) &#123;</span><br><span class="line">      var initialRoute = &#123;name: &apos;home&apos;&#125;;</span><br><span class="line">      return (</span><br><span class="line">        &lt;Navigator</span><br><span class="line">          style=&#123;styles.container&#125;</span><br><span class="line">          initialRoute=&#123;initialRoute&#125;</span><br><span class="line">          configureScene=&#123;() =&gt; Navigator.SceneConfigs.FadeAndroid&#125;</span><br><span class="line">          renderScene=&#123;this.RouteMapper&#125;</span><br><span class="line">        /&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return (</span><br><span class="line">        &lt;SplashScreen /&gt;</span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var styles = StyleSheet.create(&#123;</span><br><span class="line">  container: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    flexDirection: &apos;column&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  instructions: &#123;</span><br><span class="line">    textAlign: &apos;center&apos;,</span><br><span class="line">    color: &apos;#333333&apos;,</span><br><span class="line">    marginBottom: 5,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">AppRegistry.registerComponent(&apos;RCTZhiHuDaily&apos;, () =&gt; RCTZhiHuDaily);</span><br></pre></td></tr></table></figure></p>
<h2 id="SplashScreen-js"><a href="#SplashScreen-js" class="headerlink" title="SplashScreen.js"></a>SplashScreen.js</h2><hr>
<p>根据index.android.js的生命周期执行顺序，接下来需要看的是SplashScreen.js。</p>
<p>头部的导入几乎可以忽略，不过可以提一下<code>var WINDOW_WIDTH = Dimensions.get(&#39;window&#39;).width;</code>这个是获取设备窗口的宽度，可以很灵活的适配手机视图。</p>
<p>然后就是SplashScreen类了，简单浏览一下代码发现原来这里只是简单的展示一副图片并且使用了动画效果，看来这一页是大多数app的引导页，这样我就可以去补充刚刚上面的疑问了。</p>
<p><strong>fetchData函数</strong>：repository.getCover()这个是DataRepository里面的一个函数，return返回<code>_safeStorage(KEY_COVER)</code>,其中KEY_COVER的值为@Cover，是用来持久保存启动页的动画封面。</p>
<p>传进去一个key值到_safeStorage中去，该方法通过<code>new</code>来调用<code>Promise</code>的构造器返回一个实例化之后的promise对象，这个对象可以使用<code>promise.then()</code>方法。</p>
<p>可以看到传进去之后的key被<code>AsyncStorage</code>的<code>static getItem(key: string, callback?: ?(error: ?Error, result: ?string) =&gt; void)</code>所使用，这个方法也返回一个promise对象，将get到的item作为一个变量retData通过<code>promise的resolve</code>传出去给then方法使用。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DataRepository.prototype.getCover = function() &#123;</span><br><span class="line">  return this._safeStorage(KEY_COVER);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DataRepository.prototype._safeStorage = function(key: string) &#123; </span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    AsyncStorage.getItem(key, (error, result) =&gt; &#123;</span><br><span class="line">      var retData = JSON.parse(result);</span><br><span class="line">      if (error) &#123;</span><br><span class="line">        console.error(error);</span><br><span class="line">        resolve(null);</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        resolve(retData);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>接下来就是<code>repository.getCover().then((result) =&gt;{...}</code>的操作了,then函数能像先知一样对可能发生的结果进行不同的回调处理，如果是resolve（成功）的话就会调用<code>onFulfilled</code>方法,如果是reject(失败)的话就会被catch到error，触发<code>onRejected</code>方法，因为下面的代码都是箭头函数，因此我们不能明显看到那两个方法的名字。</p>
<p>在getCover执行完之后就开始执行的是<code>repository.updateCover();</code>我们需要倒回去看一下这个函数的实现，下面是这个方法的代码，需要贴出来的是<code>API_COVER_URL</code>,这个作为fetch的参数，后面还有then，说明是通过get方式获取到response，得到response.json，并且继续通过then方法将返回的json数据作为then的参数responseData传进去，方法里面使用AsyncStorage.setItem将其用键值对的形式永久保存起来。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DataRepository.prototype.updateCover = function() &#123;</span><br><span class="line">  fetch(API_COVER_URL)</span><br><span class="line">    .then((response) =&gt; response.json())</span><br><span class="line">    .then((responseData) =&gt; &#123;</span><br><span class="line">      AsyncStorage.setItem(KEY_COVER, JSON.stringify(responseData));</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch((error) =&gt; &#123;</span><br><span class="line">      console.error(error);</span><br><span class="line">    &#125;)</span><br><span class="line">    .done();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>getInitialState函数：返回state的两个变量<code>cover</code>为null和<code>bounceValue</code>为<code>new Animated.Value(1)</code>，其中cover肯定是后面用来装载启动页api对应的图片uri，详情可以看到<code>fetchData</code>里面的<code>setState</code>和<code>render</code>里面的<code>uri: this.state.cover.img</code>，然后<code>bounceValue</code>变量存储<code>new Animated.Value(1)</code>是rn的animated里面常见的声明实例用法了（<a href="">如果不明白请看我上一篇博客</a>），因为这里的效果是timing缩放，所以这里参数中的1表示的图像的原始形状。</p>
<p>componentDidMount函数：这个函数在render之后执行，这里的代码表示这个函数首先会执行fetchData函数，接着执行setValue又是为原型，开启动画<code>Animated.timing(animateValue, conf&lt;Object&gt;)</code>,画面再次渲染。</p>
<p>render函数：局部变量img和text，判断如果cover的api存在就分别用来存储cover.img和cover.text（至于为什么会有img和text就要自己打开api去看一下里面的json数据了），如果不存在的话img就为require(‘image!splash’),哈哈，这句没看懂，文件夹里面也没有image文件夹啊而且感叹号也不知道是什么意思。接着就是return回<animated.image>,这个动画参数需要有source（图片资源），已经将动画原始值绑定到style里面去，也就是这里的<code>transform:[{scale: this.state.bounceValue}]</code>,transform是转换的意思，scale是规模比例。<text>放{text}文字。</text></animated.image></p>
<h3 id="这里是完整代码SplashScreen-js"><a href="#这里是完整代码SplashScreen-js" class="headerlink" title="这里是完整代码SplashScreen.js"></a>这里是完整代码SplashScreen.js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">var React = require(&apos;react-native&apos;);</span><br><span class="line">var &#123;</span><br><span class="line">  AsyncStorage,</span><br><span class="line">  Image,</span><br><span class="line">  StyleSheet,</span><br><span class="line">  Text,</span><br><span class="line">  View,</span><br><span class="line">  Dimensions,</span><br><span class="line">&#125; = React;</span><br><span class="line"></span><br><span class="line">var Animated = require(&apos;Animated&apos;);</span><br><span class="line"></span><br><span class="line">var WINDOW_WIDTH = Dimensions.get(&apos;window&apos;).width;</span><br><span class="line"></span><br><span class="line">var DataRepository = require(&apos;./DataRepository&apos;);</span><br><span class="line">var repository = new DataRepository();</span><br><span class="line"></span><br><span class="line">var SplashScreen = React.createClass(&#123;</span><br><span class="line">  fetchData: function() &#123;</span><br><span class="line">    repository.getCover()</span><br><span class="line">      .then((result) =&gt; &#123;</span><br><span class="line">        if (result)&#123;</span><br><span class="line">          this.setState(&#123;cover: result&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch((error) =&gt; &#123;</span><br><span class="line">        console.error(error);</span><br><span class="line">      &#125;)</span><br><span class="line">      .done();</span><br><span class="line">    repository.updateCover();</span><br><span class="line">  &#125;,</span><br><span class="line">  getInitialState: function() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      cover: null,</span><br><span class="line">      bounceValue: new Animated.Value(1),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  componentDidMount: function() &#123;</span><br><span class="line">    this.fetchData();</span><br><span class="line">    this.state.bounceValue.setValue(1);</span><br><span class="line">    Animated.timing(</span><br><span class="line">      this.state.bounceValue,</span><br><span class="line">      &#123;</span><br><span class="line">        toValue: 1.2,</span><br><span class="line">        duration: 5000,</span><br><span class="line">      &#125;</span><br><span class="line">    ).start();</span><br><span class="line">  &#125;,</span><br><span class="line">  render: function() &#123;</span><br><span class="line">    var img, text;</span><br><span class="line">    if (this.state.cover) &#123;</span><br><span class="line">      img = &#123;uri: this.state.cover.img&#125;;</span><br><span class="line">      text = this.state.cover.text;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      img = require(&apos;image!splash&apos;);</span><br><span class="line">      text = &apos;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return(</span><br><span class="line">      &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">        &lt;Animated.Image</span><br><span class="line">          source=&#123;img&#125;</span><br><span class="line">          style=&#123;&#123;</span><br><span class="line">            flex: 1,</span><br><span class="line">            width: WINDOW_WIDTH,</span><br><span class="line">            height: 1,</span><br><span class="line">            transform: [</span><br><span class="line">              &#123;scale: this.state.bounceValue&#125;,</span><br><span class="line">            ]</span><br><span class="line">          &#125;&#125; /&gt;</span><br><span class="line">        &lt;Text style=&#123;styles.text&#125;&gt;</span><br><span class="line">            &#123;text&#125;</span><br><span class="line">        &lt;/Text&gt;</span><br><span class="line">        &lt;Image style=&#123;styles.logo&#125; source=&#123;require(&apos;image!splash_logo&apos;)&#125; /&gt;</span><br><span class="line">      &lt;/View&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var styles = StyleSheet.create(&#123;</span><br><span class="line">  container: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    flexDirection: &apos;column&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  cover: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    width: 200,</span><br><span class="line">    height: 1,</span><br><span class="line">  &#125;,</span><br><span class="line">  logo: &#123;</span><br><span class="line">    resizeMode: &apos;contain&apos;,</span><br><span class="line">    position: &apos;absolute&apos;,</span><br><span class="line">    left: 0,</span><br><span class="line">    right: 0,</span><br><span class="line">    bottom: 30,</span><br><span class="line">    height: 54,</span><br><span class="line">    backgroundColor: &apos;transparent&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  text: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    fontSize: 16,</span><br><span class="line">    textAlign: &apos;center&apos;,</span><br><span class="line">    color: &apos;white&apos;,</span><br><span class="line">    position: &apos;absolute&apos;,</span><br><span class="line">    left: 0,</span><br><span class="line">    right: 0,</span><br><span class="line">    bottom: 10,</span><br><span class="line">    backgroundColor: &apos;transparent&apos;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = SplashScreen;</span><br></pre></td></tr></table></figure>
<h2 id="MainScreen-android-js"><a href="#MainScreen-android-js" class="headerlink" title="MainScreen.android.js"></a>MainScreen.android.js</h2><hr>
<p>这里的代码相对比较少，导入那一块因为现在已经是ES6，有新的语法糖，可以使用import关键字导入。类外部声明了一个全局变量<code>DRAWER_REF = &#39;drawer&#39;</code>,<code>DRAWER_WIDTH_LEFT = 56</code>以及<code>toolbar</code>的图片和展示的一些全局设置，ok，开始分析类里面的方法：<br>构造函数getInitialState(ES6是constructor写法有所不同)：声明一个state的成员变量theme为null。</p>
<p>onSelectTheme函数：这个方法用来选择主题，方法传入一个theme，使用ref调用DRAWER_REF对应的抽屉的close方法（在ES6中应该这样使用<code>this.ref.DRAWER_REF.closeDrawer()</code>），将抽屉关闭，并且将传进去的参数theme赋值给state的theme变量。</p>
<p>_renderNavigationView函数：返回jsx语法的一个<themelist>组件，将this.onSelectTheme方法传进去其属性onSelectItem中，一旦onSelectItem触发，启动this.onSelectTheme方法。</themelist></p>
<p>onRefresh函数：调用onSelectTheme函数，用来刷新主题。</p>
<p>onRefreshFinish函数：</p>
<p>render函数：这里用局部变量draw存储<themelist>组件，并且将其属性onSelectItem触发的时候调用onSelectTheme回调函数。然后返回一个<a href="https://github.com/root-two/react-native-drawer" target="_blank" rel="external">react-native-drawer</a>库的一个实例<code>&lt;Drawer&gt;</code>组件。这里的属性比较多，一开始是ref用来标识，然后就是`openDrawerOffset</themelist></p>
<blockquote>
<p>这里的属性比较多，一开始是ref用来标识，然后就是<code>openDrawerOffset (Number|Function)</code>这个是定义抽屉当被打开的手势偏移量，参数可以是像素也可以是整数，也可以是一个方法。<code>panCloseMask (Number)</code>,鉴于英文水平不好，google上好像也找不到解释，暂时先不理[破涕为笑.jpg]。然后就是content (React.Component)根据意思可以知道也就是抽屉菜单。</p>
</blockquote>
<p>然后被这个抽屉函数包裹的当然就是知乎日报里面的list了，所以这个<storieslist>就是一开始启动动画过渡之后的知乎新闻列表，而属性的this.state.theme就是每一个item的样式，因为点击每一个新闻都可以跳转到详情页，所以navigator就是导航器，经过index.android.js的路由然后跳转到对应的页面。</storieslist></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line">&apos;use strict&apos;;</span><br><span class="line"></span><br><span class="line">var React = require(&apos;react-native&apos;);</span><br><span class="line">var &#123;</span><br><span class="line">  AsyncStorage,</span><br><span class="line">  Image,</span><br><span class="line">  StyleSheet,</span><br><span class="line">  Text,</span><br><span class="line">  View,</span><br><span class="line">  DrawerLayoutAndroid,</span><br><span class="line">  ToolbarAndroid,</span><br><span class="line">  ToastAndroid,</span><br><span class="line">  BackAndroid,</span><br><span class="line">  TouchableOpacity,</span><br><span class="line">  Dimensions,</span><br><span class="line">&#125; = React;</span><br><span class="line"></span><br><span class="line">var Drawer = require(&apos;react-native-drawer&apos;);</span><br><span class="line">var StoriesList = require(&apos;./StoriesList&apos;);</span><br><span class="line">var ThemesList = require(&apos;./ThemesList&apos;);</span><br><span class="line">var SwipeRefreshLayoutAndroid = require(&apos;./SwipeRereshLayout&apos;);</span><br><span class="line"></span><br><span class="line">var DRAWER_REF = &apos;drawer&apos;;</span><br><span class="line">var DRAWER_WIDTH_LEFT = 56;</span><br><span class="line">var toolbarActions = [</span><br><span class="line">  &#123;title: &apos;提醒&apos;, icon: require(&apos;image!ic_message_white&apos;), show: &apos;always&apos;&#125;,</span><br><span class="line">  &#123;title: &apos;夜间模式&apos;, show: &apos;never&apos;&#125;,</span><br><span class="line">  &#123;title: &apos;设置选项&apos;, show: &apos;never&apos;&#125;,</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">var MainScreen = React.createClass(&#123;</span><br><span class="line">  getInitialState: function() &#123;</span><br><span class="line">    return (&#123;</span><br><span class="line">      theme: null,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  onSelectTheme: function(theme) &#123;</span><br><span class="line">    this.refs[DRAWER_REF].closeDrawer();</span><br><span class="line">    this.setState(&#123;theme: theme&#125;);</span><br><span class="line">  &#125;,</span><br><span class="line">  _renderNavigationView: function() &#123;</span><br><span class="line">    return (</span><br><span class="line">      &lt;ThemesList</span><br><span class="line">        onSelectItem=&#123;this.onSelectTheme&#125;</span><br><span class="line">      /&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;,</span><br><span class="line">  onRefresh: function() &#123;</span><br><span class="line">    this.onSelectTheme(this.state.theme);</span><br><span class="line">  &#125;,</span><br><span class="line">  onRefreshFinish: function() &#123;</span><br><span class="line">    this.swipeRefreshLayout &amp;&amp; this.swipeRefreshLayout.finishRefresh();</span><br><span class="line">  &#125;,</span><br><span class="line">  render: function() &#123;</span><br><span class="line">    var title = this.state.theme ? this.state.theme.name : &apos;首页&apos;;</span><br><span class="line">    return (</span><br><span class="line">      &lt;DrawerLayoutAndroid</span><br><span class="line">        ref=&#123;DRAWER_REF&#125;</span><br><span class="line">        drawerWidth=&#123;Dimensions.get(&apos;window&apos;).width - DRAWER_WIDTH_LEFT&#125;</span><br><span class="line">        keyboardDismissMode=&quot;on-drag&quot;</span><br><span class="line">        drawerPosition=&#123;DrawerLayoutAndroid.positions.Left&#125;</span><br><span class="line">        renderNavigationView=&#123;this._renderNavigationView&#125;&gt;</span><br><span class="line">        &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">          &lt;ToolbarAndroid</span><br><span class="line">            navIcon=&#123;require(&apos;image!ic_menu_white&apos;)&#125;</span><br><span class="line">            title=&#123;title&#125;</span><br><span class="line">            titleColor=&quot;white&quot;</span><br><span class="line">            style=&#123;styles.toolbar&#125;</span><br><span class="line">            actions=&#123;toolbarActions&#125;</span><br><span class="line">            onIconClicked=&#123;() =&gt; this.refs[DRAWER_REF].openDrawer()&#125;</span><br><span class="line">            onActionSelected=&#123;this.onActionSelected&#125; /&gt;</span><br><span class="line">          &lt;SwipeRefreshLayoutAndroid</span><br><span class="line">            ref=&#123;(swipeRefreshLayout) =&gt; &#123; this.swipeRefreshLayout = swipeRefreshLayout; &#125;&#125;</span><br><span class="line">            onSwipeRefresh=&#123;this.onRefresh&#125;&gt;</span><br><span class="line">            &lt;StoriesList theme=&#123;this.state.theme&#125; navigator=&#123;this.props.navigator&#125;</span><br><span class="line">              onRefreshFinish=&#123;this.onRefreshFinish&#125;/&gt;</span><br><span class="line">          &lt;/SwipeRefreshLayoutAndroid&gt;</span><br><span class="line">        &lt;/View&gt;</span><br><span class="line">      &lt;/DrawerLayoutAndroid&gt;</span><br><span class="line"></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">var styles = StyleSheet.create(&#123;</span><br><span class="line">  container: &#123;</span><br><span class="line">    flex: 1,</span><br><span class="line">    flexDirection: &apos;column&apos;,</span><br><span class="line">    backgroundColor: &apos;#FAFAFA&apos;,</span><br><span class="line">  &#125;,</span><br><span class="line">  toolbar: &#123;</span><br><span class="line">    backgroundColor: &apos;#00a2ed&apos;,</span><br><span class="line">    height: 56,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">module.exports = MainScreen;</span><br></pre></td></tr></table></figure>
<p>正常需要展示给用户看的只有四个主要页面，也就是<splashscreen>, <storyscreen>, <mainscreen>, 以及抽屉的菜单页面<themelist><br>因此我觉得应该把其他剩余的小组件分析完再来解析主要的这四个，也就是从量变到质变的过程。ok，不说太多，开始：</themelist></mainscreen></storyscreen></splashscreen></p>
<h2 id="DataRepository-js"><a href="#DataRepository-js" class="headerlink" title="DataRepository.js"></a>DataRepository.js</h2><hr>
<p>这个类是所有页面需要的数据的仓库，里面聚集各种借口和网络请求，所以这个类需要存储很多东西，说到存储就当然少不了AsyncStorage，可以永久保存数据到手机内。因此一开始就声明了全局变量AsyncStorage。</p>
<p>接下来是各种接口url，以及对应的键（string）来存储对应的uri值（string）。接着就是创建显示日期的parseDateFromYYYYMMdd方法，需要传进去一个str，判断假如传进去为null则返回一个new Date()，并且会触发下面的Date子函数yyyymmdd,该函数返回当日的日期，如果有参数的话则返回一个new Date(YYYYMMdd)，显示的是参数里面的日期。</p>
<p>然后看到DataRepository方法，很明显这里是创建一个实例化的DataRepository对象，并且<code>DataRepository.instance = this;</code>来调用类暴露的所有方法，这是明显的单例模式。这里开始就要往DataRepository类里面去看了。</p>
<p>_safeStorage函数：永久保存对局，传入string类型的键，返回一个Promise构造函数，异步执行AsyncStorage的getItem方法，使用这个方法能够取出key对应的value。看到参数里面有<code>(error, result)</code>这个是观法那个大部分函数的使用的一个方式，加入没有出现error的时候就会将错误信息赋给error，如果正确执行的话就会将结果赋值给result，为什么会下面一句JSON.parse(jsonInfo),因为在我们保存的时候是用的Fetch直接将api的内容保存的，而api里面全部都是以json数据保存的，所以内容肯定就是json数据了。</p>
<p>_safeFetch函数：传入目标url</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/20/react-native学习笔记7/" itemprop="url">
                  react-native学习笔记7
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-08-20T20:39:46+08:00" content="2016-08-20">
              2016-08-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/20/react-native学习笔记7/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/20/react-native学习笔记7/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="DrawerLayoutAndroid使用"><a href="#DrawerLayoutAndroid使用" class="headerlink" title="DrawerLayoutAndroid使用"></a>DrawerLayoutAndroid使用</h2><p>这个是抽屉式布局，像我这种熟练安卓的人自然就知道所有基本的属性了。不说太多，亮代码：</p>
<p>DrawerLayout.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; View, Text, StyleSheet, DrawerLayoutAndroid &#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">export default class DrawerLayoutDemo extends Component &#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		var navigationView = (</span><br><span class="line">			&lt;View style = &#123;&#123;flex:1,backgroundColor:&apos;#ff0&apos;&#125;&#125;&gt;</span><br><span class="line">				&lt;Text style = &#123;&#123;margin: 10, fontSize: 15, textAlign: &apos;left&apos;&#125;&#125;&gt;我是抽屉&lt;/Text&gt;</span><br><span class="line">			&lt;/View&gt;</span><br><span class="line">		);</span><br><span class="line"></span><br><span class="line">		return (</span><br><span class="line">			&lt;DrawerLayoutAndroid</span><br><span class="line">				drawerWidth = &#123;100&#125;</span><br><span class="line">				drawerPosition = &#123;DrawerLayoutAndroid.positions.Right&#125;</span><br><span class="line">				renderNavigationView = &#123;() =&gt; navigationView&#125;&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;View style = &#123;&#123;flex:1,alignItems: &apos;center&apos;&#125;&#125;&gt;</span><br><span class="line">					&lt;Text style = &#123;&#123;margin:10,fontSize:15,textAlign: &apos;right&apos;&#125;&#125;&gt;Hello&lt;/Text&gt;</span><br><span class="line">					&lt;Text style = &#123;&#123;margin:10,fontSize:15,textAlign: &apos;right&apos;&#125;&#125;&gt;React native cool world!&lt;/Text&gt;</span><br><span class="line">				&lt;/View&gt;</span><br><span class="line">			&lt;/DrawerLayoutAndroid&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>drawerWidth是抽屉拉开之后展开的宽度，这里的100是比较小的，反正设计需要多大自己改就可以了。<br>drawerPosition是抽屉的位置，默认是left，这里我设置成右边，因此手势需要向左划才可以拉出抽屉。</p>
</blockquote>
<p>然后需要注意的是在使用这个已经封装好的组件的话需要单独使用，并且展示内容要在<code>&lt;DrawerLayoutAndroid&gt;&lt;/DrawerLayoutAndroid&gt;</code>。什么意思呢？就是我刚刚在我已经写过的图片选择组件下直接填加这个抽屉组件，发现拉出抽屉有效的距离仅仅是含有下面这段代码的地方<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;View style = &#123;&#123;flex:1,alignItems: &apos;center&apos;&#125;&#125;&gt;</span><br><span class="line">	&lt;Text style = &#123;&#123;margin:10,fontSize:15,textAlign: &apos;right&apos;&#125;&#125;&gt;Hello&lt;/Text&gt;</span><br><span class="line">	&lt;Text style = &#123;&#123;margin:10,fontSize:15,textAlign: &apos;right&apos;&#125;&#125;&gt;React native cool world!&lt;/Text&gt;</span><br><span class="line">&lt;/View&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>而一旦离开这段代码的区域，就不能滑动出来抽屉，而且抽屉也仅仅是一部分的，总的来说就像qq的列表那样的效果那样，只在一部分地方可以滑动出抽屉</p>
<p>如果强行给DrawerLayoutAndroid添加height，想下面这样的话就会造成加入抽屉后原来的组件内容被覆盖，假设原来的组件是有按钮的话，按钮的点击效果就会无效。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;DrawerLayoutAndroid</span><br><span class="line">				style = &#123;&#123;height:200&#125;&#125;</span><br><span class="line">				drawerWidth = &#123;100&#125;</span><br><span class="line">				drawerPosition = &#123;DrawerLayoutAndroid.positions.Right&#125;</span><br><span class="line">				renderNavigationView = &#123;() =&gt; navigationView&#125;&gt;</span><br><span class="line">				</span><br><span class="line">				...</span><br><span class="line">&lt;DrawerLayoutAndroid&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><img src="../img/drawer.png" alt="抽屉屏蔽掉图片选择器的点击效果"></p>
<p>因此建议初学的我如果需要写出想安卓那样高度铺满整个屏幕的抽屉的话，就需要在<code>&lt;DrawerLayoutAndroid&gt;&lt;/DrawerLayoutAndroid&gt;</code>里面编写了，省时便宜又实惠。就像下面的代码,就可以使用图片选择器的按钮了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; View, Text, StyleSheet, DrawerLayoutAndroid &#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">import ImageDemo from &apos;./Image&apos;</span><br><span class="line"></span><br><span class="line">var imgs = [</span><br><span class="line">  &apos;http://misc.360buyimg.com/lib/img/e/logo-201305.png&apos;,</span><br><span class="line">  &apos;https://ss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/img/logo/logo_white_fe6da1ec.png&apos;,</span><br><span class="line">  &apos;http://www.csdn.net/css/logo.png&apos;  </span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">export default class DrawerLayoutDemo extends Component &#123;</span><br><span class="line">	render()&#123;</span><br><span class="line">		var navigationView = (</span><br><span class="line">			&lt;View style = &#123;&#123;flex:1,backgroundColor:&apos;#fff&apos;&#125;&#125;&gt;</span><br><span class="line">				&lt;Text style = &#123;&#123;margin: 10, fontSize: 15, textAlign: &apos;left&apos;&#125;&#125;&gt;我是抽屉&lt;/Text&gt;</span><br><span class="line">			&lt;/View&gt;</span><br><span class="line">		);</span><br><span class="line"></span><br><span class="line">		return (</span><br><span class="line">			&lt;DrawerLayoutAndroid</span><br><span class="line">				drawerWidth = &#123;100&#125;</span><br><span class="line">				drawerPosition = &#123;DrawerLayoutAndroid.positions.Right&#125;</span><br><span class="line">				renderNavigationView = &#123;() =&gt; navigationView&#125;&gt;</span><br><span class="line"></span><br><span class="line">				&lt;View style = &#123;&#123;flex:1,alignItems: &apos;center&apos;&#125;&#125;&gt;</span><br><span class="line">					&lt;Text style = &#123;&#123;margin:10,fontSize:15,textAlign: &apos;right&apos;&#125;&#125;&gt;Hello&lt;/Text&gt;</span><br><span class="line">					&lt;Text style = &#123;&#123;margin:10,fontSize:15,textAlign: &apos;right&apos;&#125;&#125;&gt;我是抽屉1&lt;/Text&gt;</span><br><span class="line">				&lt;/View&gt;</span><br><span class="line">				</span><br><span class="line">				&lt;ImageDemo imgs = &#123;imgs&#125;&gt;&lt;/ImageDemo&gt;</span><br><span class="line">			&lt;/DrawerLayoutAndroid&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>运行起来是这样的：<br><img src="../img/drawer2.png" alt="在drawerlayoutandroid里面编写视图"></p>
<p>刚刚说到可以写出像qq那样的抽屉列表，感觉真的好像用这个方法写简单多了，不过我试过，在一个页面写上两个封装好的上面的组件是不行的，同时直接在上面的组件内写多个<drawerlayoutandroid></drawerlayoutandroid>也是运行出来是一片空白。</p>
<p>以后能力强了之后再尝试一下。</p>
<h2 id="ViewPager组件"><a href="#ViewPager组件" class="headerlink" title="ViewPager组件"></a>ViewPager组件</h2><hr>
<p>基本属性：</p>
<blockquote>
<ul>
<li>initialPage 这是初始选中页的下标</li>
<li>onPageScroll 页面滚动的回调函数，不管是动画还是用户在页面滑动/拖拽都会执行，回调参数中的<code>event.nativeEvent</code>对象会包含这些数据：<code>position</code>（位置）是一个数字，而 <code>offset</code>（偏移量）是一个在[0,1)大于等于0小于1之间的范围，很明显就是页面当前切换的状态了</li>
<li>onPageScrollStateChanged  idle(不动) dragging(拖拽) settling(停靠)</li>
<li>onPageSelected 这个回调会在页面切换完成之后（当用户在页面滑动）调用回调函数中的event.nativeEvent对象返回：position</li>
<li>onPageEnabled 滚动功能的开启与否，true表示开启，默认是true</li>
</ul>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/19/react-native学习笔记6/" itemprop="url">
                  react-native学习笔记6
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-08-19T21:19:25+08:00" content="2016-08-19">
              2016-08-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/19/react-native学习笔记6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/19/react-native学习笔记6/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="image组件"><a href="#image组件" class="headerlink" title="image组件"></a>image组件</h2><p>仿照视频顺便改了一点代码写了一个图片查看器</p>
<p>Image.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; View, Text, StyleSheet, Image, TouchableOpacity &#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">export default class ImageDemo extends Component &#123;</span><br><span class="line">	//本地图片引用方法：source = &#123;require(&apos;./img/xxx.png&apos;)&#125;</span><br><span class="line">	//网络图片引用方法：source = &#123;&#123;uri : &apos;http://host/path//.png&apos;&#125;&#125;</span><br><span class="line">	constructor (props)&#123;</span><br><span class="line">		super(props);</span><br><span class="line">		this.state = &#123;</span><br><span class="line">			count: 1,</span><br><span class="line">			imgs:this.props.imgs,</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	goPreview()&#123;</span><br><span class="line">		var Count = this.state.count;</span><br><span class="line">		Count--;</span><br><span class="line">		if(Count &gt;= 0 )&#123;</span><br><span class="line">			this.setState(&#123;</span><br><span class="line">				count:Count,</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;else &#123;</span><br><span class="line">			this.setState(&#123;</span><br><span class="line">				count:this.state.imgs.length -1,</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	goNext()&#123;</span><br><span class="line">		var Count = this.state.count;</span><br><span class="line">		Count++;</span><br><span class="line">		if(Count &lt; this.state.imgs.length)&#123;</span><br><span class="line">			this.setState(&#123;</span><br><span class="line">				count:Count,</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			this.setState(&#123;</span><br><span class="line">				count:0,</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	render()&#123;</span><br><span class="line">		return(</span><br><span class="line">			&lt;View style = &#123;[styles.flex, &#123;alignItems:&apos;center&apos;&#125;]&#125;&gt;</span><br><span class="line">				&lt;View style = &#123;styles.image&#125;&gt;</span><br><span class="line">					&lt;Image style = &#123;styles.img&#125;</span><br><span class="line">						resizeMode = &quot;contain&quot;</span><br><span class="line">						source = &#123;&#123;uri:this.state.imgs[this.state.count]&#125;&#125;</span><br><span class="line">					/&gt;</span><br><span class="line">				&lt;/View&gt;</span><br><span class="line"></span><br><span class="line">				&lt;View style = &#123;styles.btns&#125;&gt;</span><br><span class="line">					&lt;TouchableOpacity onPress = &#123;this.goPreview.bind(this)&#125;&gt;&lt;View style = &#123;styles.btn&#125;&gt;&lt;Text&gt;上一张&lt;/Text&gt;&lt;/View&gt;&lt;/TouchableOpacity&gt;</span><br><span class="line"></span><br><span class="line">					&lt;TouchableOpacity onPress = &#123;this.goNext.bind(this)&#125;&gt;&lt;View style = &#123;styles.btn&#125;&gt;&lt;Text&gt;下一张&lt;/Text&gt;&lt;/View&gt;&lt;/TouchableOpacity&gt;</span><br><span class="line">				&lt;/View&gt;</span><br><span class="line">			&lt;/View&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const styles = StyleSheet.create(&#123;</span><br><span class="line">	flex: &#123;</span><br><span class="line">		flex:1,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	image: &#123;</span><br><span class="line">		borderWidth:1,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	img: &#123;</span><br><span class="line">		height:150,</span><br><span class="line">		width:200,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	btn: &#123;</span><br><span class="line">		width:60,</span><br><span class="line">		height: 30,</span><br><span class="line">		borderColor: &apos;#0089FF&apos;,</span><br><span class="line">		borderWidth: 1,</span><br><span class="line">		justifyContent: &apos;center&apos;,</span><br><span class="line">		alignItems:&apos;center&apos;,</span><br><span class="line">		borderRadius:3,</span><br><span class="line">		marginRight:20,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	btns: &#123;</span><br><span class="line">		flexDirection: &apos;row&apos;, //设置主轴方向为水平</span><br><span class="line">		marginTop: 20,</span><br><span class="line">		justifyContent: &apos;center&apos; //设置主轴方向居中也就是水平居中了</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>在构造函数中初始化使用图片地址数字选择count，已及<code>imgs:this.props.imgs</code>，这句代码的意思和前面所学的<code>const {imgs} = this.props;</code>作用是一样的，都是把imgs作为一个灵活的组件属性，然后就可以将图片uri数组传递进去。</p>
<p>看到<image>组件，里面有一个resizeMode属性，这个属性有三个可选择的值，分别是stretch(拉伸：不保留原始分辨率)，cover(平铺：按照原图平铺)，contain(包裹：等比例放大缩小平铺),因此一般都会选择第三个，具体效果自己去测试。</image></p>
<p>关于source，在代码的注释已经解释的比较清楚了，需要注意的是source里面放的必须是静态字符串，所以不可以在source里面进行动态选择uri，要选择的话在source外面慢慢搞。</p>
</blockquote>
<p>然后就是看到goPreview和goNext方法了，这里只需要将一种就可以了，其中看到两处都用var声明的Count变量，因此知道var的作用域是整个同级节点和子节点，这个在以前的<a href="http://greatzues.github.io/2016/07/31/ES6%E5%85%A5%E9%97%A8/" target="_blank" rel="external">ES学习</a>中也提到过这个块级作用域的知识点。</p>
<h2 id="最后就是看到一些新的函数的使用了，也就是length函数返回对应对象的长度，可以通过setState对state的变量进行动态赋值。"><a href="#最后就是看到一些新的函数的使用了，也就是length函数返回对应对象的长度，可以通过setState对state的变量进行动态赋值。" class="headerlink" title="最后就是看到一些新的函数的使用了，也就是length函数返回对应对象的长度，可以通过setState对state的变量进行动态赋值。"></a>最后就是看到一些新的函数的使用了，也就是length函数返回对应对象的长度，可以通过setState对state的变量进行动态赋值。</h2><h3 id="引用的时候就只需要这样写："><a href="#引用的时候就只需要这样写：" class="headerlink" title="引用的时候就只需要这样写："></a>引用的时候就只需要这样写：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import ImageDemo from &apos;./Image&apos;;</span><br><span class="line"></span><br><span class="line">var imgs = [</span><br><span class="line">  &apos;http://misc.360buyimg.com/lib/img/e/logo-201305.png&apos;,</span><br><span class="line">  &apos;https://ss0.bdstatic.com/5aV1bjqh_Q23odCf/static/superman/img/logo/logo_white_fe6da1ec.png&apos;,</span><br><span class="line">  &apos;http://www.csdn.net/css/logo.png&apos;  </span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">class Main extends Component &#123;</span><br><span class="line">  render() &#123;</span><br><span class="line">    return(</span><br><span class="line">      &lt;ImageDemo imgs = &#123;imgs&#125;&gt;&lt;/ImageDemo&gt;</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">AppRegistry.registerComponent(&apos;YourProject&apos;, () =&gt; Main);</span><br></pre></td></tr></table></figure>
<h2 id="Picker函数"><a href="#Picker函数" class="headerlink" title="Picker函数"></a>Picker函数</h2><hr>
<p>这个比较简单，等会记下一点东西就可以了。直接上代码吧！</p>
<h3 id="Picker-js"><a href="#Picker-js" class="headerlink" title="Picker.js"></a>Picker.js</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; View, Text, StyleSheet, Picker, ProgressBarAndroid &#125; from &apos;react-native&apos;</span><br><span class="line"></span><br><span class="line">export default class PickerDemo extends Component &#123;</span><br><span class="line">	constructor(props)&#123;</span><br><span class="line">		super(props);</span><br><span class="line">		this.state = &#123;</span><br><span class="line">			language:null,</span><br><span class="line">		&#125;;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	render()&#123;</span><br><span class="line">		return(</span><br><span class="line">			&lt;View&gt;</span><br><span class="line">				&lt;Text&gt;Picker组件&lt;/Text&gt;</span><br><span class="line"></span><br><span class="line">				&lt;Picker </span><br><span class="line">				selectedValue = &#123;this.state.language&#125;</span><br><span class="line">				onValueChange = &#123;(lang) =&gt; this.setState(&#123;language: lang&#125;)&#125;</span><br><span class="line">				mode = &quot;dropdown&quot;</span><br><span class="line">				style = &#123;&#123;color:&apos;#f00&apos;&#125;&#125;&gt;</span><br><span class="line"></span><br><span class="line">					&lt;Picker.Item label = &quot;Jave&quot; value = &quot;java&quot; /&gt;</span><br><span class="line">					&lt;Picker.Item label = &quot;Javascript&quot; value = &quot;js&quot; /&gt;</span><br><span class="line">					&lt;Picker.Item label = &quot;C语言&quot; value = &quot;C&quot; /&gt;</span><br><span class="line">					&lt;Picker.Item label = &quot;Php开发&quot; value = &quot;Php&quot; /&gt;</span><br><span class="line">					&lt;Picker.Item label = &quot;Python开发&quot; value = &quot;Python&quot; /&gt;</span><br><span class="line">				&lt;/Picker&gt;</span><br><span class="line"></span><br><span class="line">				&lt;Text&gt;&#123;this.state.language&#125;&lt;/Text&gt;</span><br><span class="line"></span><br><span class="line">				&#123;/**</span><br><span class="line">					styleAttr（进度条样式）： Horizontal Small Large Inverse SmallInverse LargeInverse </span><br><span class="line">					progress： 进度值在0-1之间</span><br><span class="line">				**/&#125;</span><br><span class="line">				&lt;ProgressBarAndroid styleAttr = &quot;Horizontal&quot; /&gt;</span><br><span class="line">			&lt;/View&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>直接看到<code>onValueChange = {(lang) =&gt; this.setState({language:lang})}</code>这段代码，这里需要注意的是将改变的value值传递给回调函数的自定义参数lang，我们可以这么想，这里少了一个步骤，就是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">onValueChange = &#123;</span><br><span class="line">	lang = value,</span><br><span class="line">	(lang) =&gt; this.setState(&#123;language: lang&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>然而这仅仅是我为了理解想出来的一个步骤而已，因此上面的onValueChange改变的是value值，而不是label值，所以这段代码在模拟器上运行起来的时候就可以很明显的看到了，最下面的<text>组件显示的text是Picker.Item的value值，而在picker上显示的是label值。</text></p>
<p>最后是mode，这个mode除了“dialog（对话框）”以外还有<code>dropdown</code>（下拉），默认是dialog。其他属性请看<a href="https://facebook.github.io/react-native/docs/picker.html" target="_blank" rel="external">官方帮助文档</a>。</p>
<h2 id="ProgressBarAndroid-和-ProgressViewIOS"><a href="#ProgressBarAndroid-和-ProgressViewIOS" class="headerlink" title="ProgressBarAndroid 和 ProgressViewIOS"></a>ProgressBarAndroid 和 ProgressViewIOS</h2><hr>
<p>代码在上面，因为progress分android和ios的，所以以后是需要自定义封装好在一个组件里面使用的。</p>
<p>主要有两个属性，分别是styleAttr和progress。<br>styleAttr（进度条样式）： Normal(普通) Horizontal(水平) Small(小圆圈) Large(大圆圈) Inverse(中圆圈) SmallInverse(也是小圆圈) LargeInverse(大圆圈) ，哈哈，好像Small和SmallInverse以及Large和LargeInverse是一样的<br>progress： 进度值在0-1之间</p>
<p>了解<a href="https://facebook.github.io/react-native/docs/progressbarandroid.html" target="_blank" rel="external">其他属性访问这里</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/18/react-native学习笔记5/" itemprop="url">
                  react-native学习笔记5
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-08-18T20:36:57+08:00" content="2016-08-18">
              2016-08-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/18/react-native学习笔记5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/18/react-native学习笔记5/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="仿百度搜索框"><a href="#仿百度搜索框" class="headerlink" title="仿百度搜索框"></a>仿百度搜索框</h2><p>仅仅是模仿ui，在输入词的时候会弹出提示。</p>
<p>TextInput.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">import React , &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; View, Text, StyleSheet, TextInput, PixelRatio &#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">var onePt = 1 / PixelRatio.get();//或许安卓设备的一个最小单位，方便适配</span><br><span class="line"></span><br><span class="line">export default class TextInputDemo extends Component &#123;</span><br><span class="line"></span><br><span class="line">	//show boolean this.state</span><br><span class="line">	//value 显示的值</span><br><span class="line">	constructor(props) &#123;</span><br><span class="line">		super(props);</span><br><span class="line">		this.state = &#123;</span><br><span class="line">			show : false,</span><br><span class="line">			value: null,</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	getValue = (text) =&gt; &#123;</span><br><span class="line">		this.setState(&#123;</span><br><span class="line">			show : true,</span><br><span class="line">			value : text,</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	hide = (val) =&gt; &#123;</span><br><span class="line">		this.setState (&#123;</span><br><span class="line">			show : false, 	</span><br><span class="line">			value : val,</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	render() &#123;</span><br><span class="line">		return (</span><br><span class="line">			&lt;View style = &#123;styles.flex&#125;&gt;</span><br><span class="line">				&lt;View style = &#123;styles.flexDirection&#125;&gt;</span><br><span class="line">					&lt;View style = &#123;[styles.flex,styles.input]&#125;&gt;</span><br><span class="line">						&lt;TextInput </span><br><span class="line">							keyboardType = &quot;web-search&quot;</span><br><span class="line">							value = &#123;this.state.value&#125; </span><br><span class="line">							onChangeText=&#123;this.getValue.bind(this)&#125;</span><br><span class="line">							placeholder = &quot;请输入关键词&quot;/&gt;</span><br><span class="line">					&lt;/View&gt;</span><br><span class="line"></span><br><span class="line">					&lt;View style = &#123;styles.btn&#125;&gt;</span><br><span class="line">						&lt;Text style = &#123;styles.search&#125; onPress = &#123;this.hide.bind(this, this.state.value)&#125;&gt;搜索&lt;/Text&gt;</span><br><span class="line">					&lt;/View&gt;</span><br><span class="line">				&lt;/View&gt;</span><br><span class="line">				&#123;this.state.show?</span><br><span class="line">						&lt;View style = &#123;styles.result&#125;&gt;</span><br><span class="line">							&lt;Text onPress = &#123;this.hide.bind(this, this.state.value + &apos;哈哈哈哈&apos;)&#125;</span><br><span class="line">							style = &#123;styles.item&#125; numberOfLines = &#123;1&#125; &gt; &#123;this.state.value&#125;哈哈哈哈&lt;/Text&gt;</span><br><span class="line">							&lt;Text onPress = &#123;this.hide.bind(this, this.state.value + &apos;北京&apos;)&#125;</span><br><span class="line">							style = &#123;styles.item&#125; numberOfLines = &#123;1&#125; &gt; &#123;this.state.value&#125;北京&lt;/Text&gt;</span><br><span class="line">							&lt;Text onPress = &#123;this.hide.bind(this, 80 + this.state.value + &apos;综合商店&apos;)&#125;</span><br><span class="line">							style = &#123;styles.item&#125; numberOfLines = &#123;1&#125; &gt; 80&#123;this.state.value&#125;综合商店&lt;/Text&gt;</span><br><span class="line">							&lt;Text onPress = &#123;this.hide.bind(this, this.state.value + &apos;cool&apos;)&#125;</span><br><span class="line">							style = &#123;styles.item&#125; numberOfLines = &#123;1&#125; &gt; &#123;this.state.value&#125;cool&lt;/Text&gt;</span><br><span class="line">							&lt;Text onPress = &#123;this.hide.bind(this, &apos;吃饭&apos; + this.state.value )&#125;</span><br><span class="line">							style = &#123;styles.item&#125; numberOfLines = &#123;1&#125; &gt;吃饭&#123;this.state.value&#125;&lt;/Text&gt;</span><br><span class="line">						&lt;/View&gt;</span><br><span class="line">						: null</span><br><span class="line">					&#125;</span><br><span class="line">			&lt;/View&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const styles = StyleSheet.create(&#123;</span><br><span class="line">	flex: &#123;</span><br><span class="line">		flex:1,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	flexDirection: &#123;</span><br><span class="line">		flexDirection:&apos;row&apos;,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	btn: &#123;</span><br><span class="line">		width:45,</span><br><span class="line">		marginLeft:-5,</span><br><span class="line">		marginRight:5,</span><br><span class="line">		backgroundColor:&apos;#23BEFF&apos;,</span><br><span class="line">		height:50,</span><br><span class="line">		justifyContent:&apos;center&apos;,</span><br><span class="line">		alignItems:&apos;center&apos;</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	search: &#123;</span><br><span class="line">		color:&apos;#fff&apos;,</span><br><span class="line">		fontSize:15,</span><br><span class="line">		fontWeight:&apos;bold&apos;,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	item: &#123;</span><br><span class="line">		fontSize:16,</span><br><span class="line">		paddingTop:5,</span><br><span class="line">		paddingBottom:10,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	result: &#123;</span><br><span class="line">		marginTop:onePt,</span><br><span class="line">		marginLeft:18,</span><br><span class="line">		marginRight:5,</span><br><span class="line">		height:200.</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	input: &#123;</span><br><span class="line">		height:50,</span><br><span class="line">		borderColor:&apos;red&apos;,</span><br><span class="line">		borderWidth:1,</span><br><span class="line">		marginLeft:10,</span><br><span class="line">		paddingLeft:5,</span><br><span class="line">		borderRadius:5,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	topStatue: &#123;</span><br><span class="line">		marginTop:25,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>在构造函数中创建一个value值用来传递，以及提示框的开关show，显示的时候为true。</p>
<p>在 <code>&lt;TextInput&gt;</code>中<code>keyboardType = &quot;web-search&quot;</code>表示的是<strong>显示便于在网页上书写的虚拟键盘</strong>,而placeholder则是占位符，一般填写请输入关键字之类的，value是框里面显示的文字，为空的时候显示的是占位符（假如有占位符）。</p>
<p>最后是onChangeText属性，这个属性在value值改变的时候触发，返回改变之后的value给回调函数，因此这里的代码：<code>onChangeText={this.getValue.bind(this)}</code>意思就是在text改变的时候返回参数给回调函数getValue，可以看到该函数记接收到函数之后，将其作为参数赋值给value了。</p>
<blockquote>
<p>同理可以看到下面<text>的代码：<code>onPress = {this.hide.bind(this, this.state.value + &#39;哈哈哈哈&#39;)</code>,这句代码和刚刚的bind只有一个参数的明显不一样，这句代码的意思是在<code>onPress(this, i)</code>被调用的时候传递调用的参数<code>i</code>，这个绑定参数的做法我是比较少见到的。然而这不是React的新概念，而是javascript的。</text></p>
</blockquote>
<p>于是后面的代码就基本上可以不用看了，在hide将onPress传递过去的参数赋值到value，于是就有了提示的词取代了原来的值。</p>
<h2 id="animated使用"><a href="#animated使用" class="headerlink" title="animated使用"></a>animated使用</h2><hr>
<p>首先推荐这篇博客： <a href="http://www.cnblogs.com/vajoy/p/5299315.html" target="_blank" rel="external">ReactNative入门 —— 动画篇（上）</a>,里面介绍的非常详细，我这里是为了自己加深印象，所以结合代码再整理一下思路。</p>
<blockquote>
<p>基本的Animated组件有Animated.View、Animated.Image、Animated.Text三种，animated支持三种动画效果：<code>spring``decay``timing</code>。<code>Interpolation插值函数</code>，4种动画组合：同时、顺序、错峰、延迟,动画执行回调，跟踪动态值，animated.event输入事件，响应当前的动画值等功能。</p>
<p>将初始值绑定到动画目标属性上，如style。调用start启动动画stop停止动画，同时可以在start里面回调相关功能。</p>
<ul>
<li><p>Animated.timing(animateValue, conf<object>) ,透明效果,第二个conf<object>设置参数参考：</object></object></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  duration: 动画持续的时间（单位是毫秒），默认为500。</span><br><span class="line">  easing：一个用于定义曲线的渐变函数。阅读Easing模块可以找到许多预定义的函数。iOS默认为Easing.inOut(Easing.ease)。</span><br><span class="line">  delay: 在一段时间之后开始动画（单位是毫秒），默认为0。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Animated.spring(animateValue, conf<object>) ,基础的单次弹跳物理模型,conf<object>设置参数参考：</object></object></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  friction: 控制“弹跳系数”、夸张系数，默认为7。</span><br><span class="line">  tension: 控制速度，默认40。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Animated.decay(animateValue, conf<object>) ,以一个初始速度开始并且逐渐减慢停止,conf<object>设置参数参考：</object></object></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  velocity: 起始速度，必填参数。</span><br><span class="line">  deceleration: 速度衰减比例，默认为0.997。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<p>第一个参数是实例化动画的初始值，一般会在构造函数中声明，将初始值赋给state里面的变量。其中使用Animated.Value设定一个或多个初始值，例如位置属性，透明属性，角度属性等。</p>
<h3 id="监听动画"><a href="#监听动画" class="headerlink" title="监听动画"></a>监听动画</h3><p>使用<code>animateValue.stopAnimation(callback&lt;Function&gt;)</code>或者是<code>animateValue.addListener(callback&lt;Function&gt;)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">import React, &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; View, Text, StyleSheet, Animated, TouchableOpacity, Easing&#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">var animteHandler;</span><br><span class="line">export default class AnimatedDemo extends Component &#123;</span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">        animateHandler = Animated.timing(this.state.opacityAnmValue, &#123;</span><br><span class="line">            toValue: 1,  //透明度动画最终值</span><br><span class="line">            duration: 3000,   //动画时长3000毫秒</span><br><span class="line">            easing: Easing.bezier(0.15, 0.73, 0.37, 1.2)  //缓动函数</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;</span><br><span class="line">            opacityAnmValue : new Animated.Value(0)   //设置透明度动画初始值</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _onPress() &#123;</span><br><span class="line">       animateHandler.start &amp;&amp; animateHandler.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;View style=&#123;styles.container&#125;&gt;</span><br><span class="line">                &lt;Animated.View ref=&quot;view&quot; style=&#123;[styles.content, &#123;width: 200, height: 20, opacity: this.state.opacityAnmValue&#125;]&#125;&gt;</span><br><span class="line">                    &lt;Text style=&#123;[&#123;textAlign: &apos;center&apos;&#125;]&#125;&gt;Hi, here is VaJoy&lt;/Text&gt;</span><br><span class="line">                &lt;/Animated.View&gt;</span><br><span class="line">                &lt;TouchableOpacity onPress=&#123;this._onPress&#125;&gt;</span><br><span class="line">                    &lt;View style=&#123;styles.button&#125;&gt;</span><br><span class="line">                        &lt;Text style=&#123;styles.buttonText&#125;&gt;Press me!&lt;/Text&gt;</span><br><span class="line">                    &lt;/View&gt;</span><br><span class="line">                &lt;/TouchableOpacity&gt;</span><br><span class="line">                &lt;TouchableOpacity &gt;</span><br><span class="line">                    &lt;View style=&#123;styles.button&#125;&gt;</span><br><span class="line">                        &lt;Text style=&#123;styles.buttonText&#125;&gt;忽略本按钮&lt;/Text&gt;</span><br><span class="line">                    &lt;/View&gt;</span><br><span class="line">                &lt;/TouchableOpacity&gt;</span><br><span class="line">            &lt;/View&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const styles = StyleSheet.create(&#123;</span><br><span class="line">	container:&#123;</span><br><span class="line">		flex:1,</span><br><span class="line">		justifyContent: &apos;center&apos;,</span><br><span class="line">		alignItems: &apos;center&apos;,</span><br><span class="line">	&#125;,</span><br><span class="line">	buttonText:&#123;</span><br><span class="line">		fontSize:16,</span><br><span class="line">		color: &apos;white&apos;,</span><br><span class="line">		fontWeight: &apos;bold&apos;,</span><br><span class="line">	&#125;,</span><br><span class="line">	button:&#123;</span><br><span class="line">		marginTop: 10,</span><br><span class="line">		paddingVertical: 10,</span><br><span class="line">		paddingHorizontal: 20,</span><br><span class="line">		backgroundColor: &apos;black&apos;,</span><br><span class="line">	&#125;,</span><br><span class="line">	content: &#123;</span><br><span class="line">		justifyContent: &apos;center&apos;,</span><br><span class="line">		backgroundColor: &apos;yellow&apos;,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>经过我一日一夜的探索，终于找到一点技巧了，首先在构造函数中设置state的成员变量<code>opacityAnmValue</code>为<code>new Animated.Value(0)</code>,正如注释所说，这是设置透明度初始值。</p>
<p>然后是render函数中在对应的<code>&lt;Animated.View&gt;</code>中绑定opacity传入到style中，编写onPress方法，在按下按钮的时候调用start()方法开始动画，因为有了开始的方法，当然也会有动画的设置参数。</p>
<p>因此最后是在componentDidMount中设置动画启动前的参数，因为是timming，所以会有duration和<a href="https://github.com/facebook/react-native/blob/master/Libraries/Animated/src/Easing.js" target="_blank" rel="external">Easing</a>（Easing动画函数模块会在<code>react-native/Libraries/Animated/src/</code>目录下，该模块与预设了linear，ease，elastic，bezier等缓动特性。）,toVlaue是透明度动画的最终值，这里的1代表的是100%不透明。</p>
<p>呃，还是提一下好，一开始写demo的时候一直在报错<code>underfined is not an object(&#39;animatehandler.start&#39;)</code>，而animatehandler这个变量只有在ComponentDidMount和_onPress使用到，后来折腾了一下午，卧槽，原来是ComponentDidMount的首字母写成大写了，导致赋值函数一直没有被调用，其实是小写componentDidMount，我都快哭出来了，浪费了我一个下午，这是个血淋林的教训啊！</p>
<p>ok,以后复习的时候就结合自己这篇博客的分析逻辑和开头分享的博客一对一找回感觉，这篇博客就先到这里，有问题欢迎提出来。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/13/react-native学习笔记4/" itemprop="url">
                  react-native学习笔记4
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Veröffentlicht am</span>
            <time itemprop="dateCreated" datetime="2016-08-13T17:12:46+08:00" content="2016-08-13">
              2016-08-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">in</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/react/" itemprop="url" rel="index">
                    <span itemprop="name">react</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/13/react-native学习笔记4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2016/08/13/react-native学习笔记4/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>跟着react-native中文网提供的视频制作了一个button，有点感想，我觉得需要写下来,先贴代码：</p>
<p>index.android.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import React , &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; View, Text,  StyleSheet, AppRegistry &#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">import Button from &apos;./Button&apos;;</span><br><span class="line"></span><br><span class="line">class MyProject extends Component &#123;</span><br><span class="line">	fetchData = (enableCallback) =&gt; &#123;</span><br><span class="line">		console.log(3);</span><br><span class="line"></span><br><span class="line">		//禁用按钮,使用ref调用ButtonDemo中暴露出来的方法</span><br><span class="line">		// this.refs.button.disable();</span><br><span class="line">		// alert(&apos;正在获取数据&apos;);</span><br><span class="line">		this.timer = setTimeout(()=&gt;&#123;</span><br><span class="line">			// this.refs.button.enable();</span><br><span class="line">			enableCallback();</span><br><span class="line">		&#125;,3000);</span><br><span class="line">		//获取玩数据之后启用按钮</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	componentWillUnmount() &#123;</span><br><span class="line">		this.timer &amp;&amp; clearTimeout(this.timer);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	render() &#123;</span><br><span class="line">		return (</span><br><span class="line">			&lt;View style = &#123;styles.Container&#125;&gt;</span><br><span class="line">				&#123;/* ref就相当于html中的id，用于标记和引用组件*/&#125;</span><br><span class="line">				&lt;ButtonDemo ref=&quot;button&quot; onPress=&#123;this.fetchData&#125; text=&quot;提交&quot; /&gt;</span><br><span class="line">			&lt;/View&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">const styles = StyleSheet.create(&#123;</span><br><span class="line">	Container: &#123;</span><br><span class="line">		flex: 1,</span><br><span class="line">		justifyContent: &apos;center&apos;,</span><br><span class="line">		alignItems: &apos;center&apos;,</span><br><span class="line">		backgroundColor: &apos;#F5FCFF&apos;,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">AppRegistry.registerComponent(&apos;AwesomeProject&apos;, () =&gt; MyProject);</span><br></pre></td></tr></table></figure></p>
<p>Button.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">import React , &#123; Component &#125; from &apos;react&apos;;</span><br><span class="line">import &#123; View, Text, StyleSheet, TouchableOpacity&#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">export default class Button extends Component &#123;</span><br><span class="line">	constructor(props) &#123;</span><br><span class="line">		super(props);</span><br><span class="line">		//初始状态</span><br><span class="line">		this.state = &#123;</span><br><span class="line">			disabled : false,</span><br><span class="line">		&#125;;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	onPress = () =&gt; &#123;</span><br><span class="line">		console.log(1);</span><br><span class="line">		const &#123; onPress &#125; = this.props;//把onPress作为一个变量属性</span><br><span class="line">		this.disable();</span><br><span class="line">		onPress(this.enable); //触发onPress</span><br><span class="line">	&#125;;</span><br><span class="line">	enable = () =&gt; &#123;</span><br><span class="line">		console.log(4);</span><br><span class="line">		this.setState(&#123;</span><br><span class="line">			disabled : false,</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;;</span><br><span class="line">	disable = () =&gt; &#123;</span><br><span class="line">		console.log(2);</span><br><span class="line">		this.setState(&#123;</span><br><span class="line">			disabled : true,</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;;</span><br><span class="line"></span><br><span class="line">	render() &#123;</span><br><span class="line">		const &#123; text &#125; = this.props;</span><br><span class="line">		return (</span><br><span class="line">			&lt;TouchableOpacity</span><br><span class="line">				disabled = &#123;this.state.disabled&#125;</span><br><span class="line">				style = &#123;[styles.button, this.state.disabled &amp;&amp; styles.disabled]&#125; //第二个样式成立的条件是disabled为true也就是button禁用的时候那么返回disabled的样式</span><br><span class="line">				onPress = &#123;this.onPress&#125;&gt;</span><br><span class="line">				&lt;Text style=&#123;styles.buttonText&#125;&gt;&#123;text&#125;&lt;/Text&gt;</span><br><span class="line">			&lt;/TouchableOpacity&gt;</span><br><span class="line">		);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const styles = StyleSheet.create(&#123;</span><br><span class="line">	button: &#123;</span><br><span class="line">		marginTop: 50,</span><br><span class="line">		height: 40,</span><br><span class="line">		width: 200,</span><br><span class="line">		borderRadius: 20,</span><br><span class="line">		justifyContent: &apos;center&apos;,</span><br><span class="line">		alignItems: &apos;center&apos;,</span><br><span class="line">		backgroundColor: &apos;green&apos;,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	buttonText: &#123;</span><br><span class="line">		fontSize: 16,</span><br><span class="line">		color: &apos;white&apos;,</span><br><span class="line">	&#125;,</span><br><span class="line"></span><br><span class="line">	disabled: &#123;</span><br><span class="line">		backgroundColor: &apos;gray&apos;,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>Button.js的代码封装了一个button，在reactnative的api中凡是含有Touchable都可以被认为是按钮。在构造函数中的状态属性state创建了一个变量disable为false，这个用来为后面的touchableOpacity的disabled属性做铺垫。</p>
<p>另外创建了几个方法，中文网视频里建议我们在class里面写方法的时候都使用类似<code>onPress = () =&gt;{...};</code>来写，这样可以和默认的函数区分下来，例如render函数和constructor函数，当然也可以使用<code>onPress(){}</code>,记住这里结尾没有符号。</p>
<p>还有需要注意的是代码里面有一个用法，<code>const {} = this.props;</code>这句代码在封装函数里面我觉得是比较重要的，道理说不上来，因为这样会使的封装的类比较灵活。</p>
<p>又看了一遍视频，更加深入的了解了函数的执行过程，点击封装好的button时，首先触发的不是fetchData函数，而是父组件的<touchableopacity>中的onPress属性，而属性指向自定义的onPress方法。于是看到方法体里面先将onPress作为父组件的一个属性，于是父组件才出现了onPress属性，先跳过this.disable，可以看到后面执行的其实是父组件的onPress方法，这里一定要区分父组件的onPress和<touchableopacity>的onPress。父组件的onPress是在使用父组件<buttondemo>里面的onPress属性，好了，接着刚刚的分析，父子间里面的自定义onPress方法里面创建了onPress为父组件的一个属性值之后并且自己调用这个属性所包裹的方法，也就到了fetchData方法了，接着就很明显是处理数据的方法了。</buttondemo></touchableopacity></touchableopacity></p>
<p>哈哈，感觉还是蛮峰回路转的，不过倒也挺有趣。</p>
<h2 id="navigator"><a href="#navigator" class="headerlink" title="navigator"></a>navigator</h2><hr>
<p>在rn中文网里面有一篇关于<a href="http://reactnative.cn/post/20" target="_blank" rel="external">新手入门navigator</a>的博文，特地去对应的github上clone一份到本地，安装别人写好的项目可以使用下面这段命令，进入到项目根目录下输入</p>
<blockquote>
<p>npm install &amp;&amp; react-native run-android</p>
</blockquote>
<p>main.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123;</span><br><span class="line">        View,</span><br><span class="line">        Navigator</span><br><span class="line">    &#125; from &apos;react-native&apos;;</span><br><span class="line"> import FirstPageComponent from &apos;./FirstPageComponent&apos;;</span><br><span class="line">    </span><br><span class="line">    export default class SampleComponent extends React.Component &#123;</span><br><span class="line">        render() &#123;</span><br><span class="line">            let defaultName = &apos;FirstPageComponent&apos;;</span><br><span class="line">            let defaultComponent = FirstPageComponent;</span><br><span class="line">            return (</span><br><span class="line">            &lt;Navigator</span><br><span class="line">              initialRoute=&#123;&#123; name: defaultName, component: defaultComponent &#125;&#125;</span><br><span class="line">              configureScene=&#123;(route) =&gt; &#123;</span><br><span class="line">                return Navigator.SceneConfigs.VerticalDownSwipeJump;</span><br><span class="line">              &#125;&#125;</span><br><span class="line">              renderScene=&#123;(route, navigator) =&gt; &#123;</span><br><span class="line">                let Component = route.component;</span><br><span class="line">                return &lt;Component &#123;...route.params&#125; navigator=&#123;navigator&#125; /&gt;</span><br><span class="line">              &#125;&#125; /&gt;</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>步骤：import进去navigator，直接在render方法内创建初始化渲染的组件，看到initialRoute里面有name和component，其中最主要的是component，除了说明初始化的时候指向这个组件以外，在下面的<code>let Component = route.component;</code>使用的就是这里的component。</p>
<p>然后是过渡动画configureScene，没什么好说的，自己到项目根目录这个路径下能看到各种动画：<code>node_modules/react-native/Libraries/CustomComponents/Navigator/NavigatorSceneConfigs.js</code></p>
<p>最后是renderScene，这个类似路由，能够将当前initialRoute的route传进来,route最基本要有一个component，因此route包括上面的name和component，还包括一些参数（假如有参数需要传递）。因此能看到上面的代码返回了一个组件route.component，也就是当前初始化的FirstPageComponent。</p>
<p>FirstPageComponent.js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123;</span><br><span class="line">    View,</span><br><span class="line">    Navigator</span><br><span class="line">&#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">import SecondPageComponent from &apos;./SecondPageComponent&apos;;</span><br><span class="line"></span><br><span class="line">export default class FirstPageComponent extends React.Component &#123;</span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    _pressButton() &#123;</span><br><span class="line">        const &#123; navigator &#125; = this.props;</span><br><span class="line">        //为什么这里可以取得 props.navigator?请看上文:</span><br><span class="line">        //&lt;Component &#123;...route.params&#125; navigator=&#123;navigator&#125; /&gt;</span><br><span class="line">        //这里传递了navigator作为props</span><br><span class="line">        if(navigator) &#123;</span><br><span class="line">            navigator.push(&#123;</span><br><span class="line">                name: &apos;SecondPageComponent&apos;,</span><br><span class="line">                component: SecondPageComponent,</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;View&gt;</span><br><span class="line">                &lt;TouchableOpacity onPress=&#123;this._pressButton.bind(this)&#125;&gt;</span><br><span class="line">                    &lt;Text&gt;点我跳转&lt;/Text&gt;</span><br><span class="line">                &lt;/TouchableOpacity&gt;</span><br><span class="line">            &lt;/View&gt;</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>代码注释的很明白，因为上面使用的组件用了一个navigator属性，因此前提肯定是FirstPageComponent已经创建了一个navigator属性，所以才有<code>const { navigator } = this.props;</code>.</p>
<p>判断是否存在navigator，也就是被调用的组件是否存在于一个<code>&lt;navigator&gt;</code>里面，如果被包裹的话，就使用navigator来push推一个栈到当前initialRoute，FirstPageComponent被压到栈底。</p>
<p>SecondPageComponent .js<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import React from &apos;react&apos;;</span><br><span class="line">import &#123;</span><br><span class="line">    View,</span><br><span class="line">    Navigator</span><br><span class="line">&#125; from &apos;react-native&apos;;</span><br><span class="line"></span><br><span class="line">import FirstPageComponent from &apos;./FirstPageComponent&apos;;</span><br><span class="line"></span><br><span class="line">export default class SecondPageComponent extends React.Component &#123;</span><br><span class="line"></span><br><span class="line">    constructor(props) &#123;</span><br><span class="line">        super(props);</span><br><span class="line">        this.state = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _pressButton() &#123;</span><br><span class="line">        const &#123; navigator &#125; = this.props;</span><br><span class="line">        if(navigator) &#123;</span><br><span class="line">            //很熟悉吧，入栈出栈~ 把当前的页面pop掉，这里就返回到了上一个页面:FirstPageComponent了</span><br><span class="line">            navigator.pop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">    return (</span><br><span class="line">            &lt;View&gt;</span><br><span class="line">                &lt;TouchableOpacity onPress=&#123;this._pressButton.bind(this)&#125;&gt;</span><br><span class="line">                    &lt;Text&gt;点我跳回去&lt;/Text&gt;</span><br><span class="line">                &lt;/TouchableOpacity&gt;</span><br><span class="line">            &lt;/View&gt;</span><br><span class="line">    );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>一样的判断，就和注释说的一样，把当前的pop抛出，于是FirstPageComponent就又变成当前route.component。</p>
<p>下面是navigator的详细属性：</p>
<blockquote>
<p>getCurrentRoutes() - 获取当前栈里的路由，也就是push进来，没有pop掉的那些<br>jumpBack() - 跳回之前的路由，当然前提是保留现在的，还可以再跳回来，会给你保留原样。<br>jumpForward() - 上一个方法不是调到之前的路由了么，用这个跳回来就好了<br>jumpTo(route) - Transition to an existing scene without unmounting<br>push(route) - Navigate forward to a new scene, squashing any scenes that you could jumpForward to<br>pop() - Transition back and unmount the current scene<br>replace(route) - Replace the current scene with a new route<br>replaceAtIndex(route, index) - Replace a scene as specified by an index<br>replacePrevious(route) - Replace the previous scene<br>immediatelyResetRouteStack(routeStack) - Reset every scene with an array of routes<br>popToRoute(route) - Pop to a particular scene, as specified by its route. All scenes after it will be unmounted<br>popToTop() - Pop to the first scene in the stack, unmounting every other scene</p>
</blockquote>
<p>详情看<a href="http://reactnative.cn/post/20" target="_blank" rel="external">这里</a>。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/default_avatar.jpg"
               alt="漏雨" />
          <p class="site-author-name" itemprop="name">漏雨</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">46</span>
              <span class="site-state-item-name">Artikel</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">Kategorien</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">Tags</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">漏雨</span>
</div>

<div class="powered-by">
  Erstellt mit  <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>





      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=0.5.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'greatzuesgithubio';
      var disqus_identifier = 'index.html';
      var disqus_title = '';
      var disqus_url = '';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
    </script>
  



  
  
  

  


</body>
</html>
